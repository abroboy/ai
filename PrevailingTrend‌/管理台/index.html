<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- IE å…¼å®¹æ€§å¤„ç† -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- æ€§èƒ½ä¼˜åŒ–ï¼šå¯ç”¨ä¸¥æ ¼æ¨¡å¼ -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://cdn.jsdelivr.net; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;">
  <!-- å…³é”®èµ„æºé¢„åŠ è½½ -->
  <link rel="preload" href="static/js/global_capital_flow.js" as="script" crossorigin>
  <link rel="preload" href="static/js/domestic_hotspot_enhanced.js" as="script" crossorigin>
  <!-- æ€§èƒ½ä¼˜åŒ–ï¼šå†…è”å…³é”®CSS -->
  <style id="critical-css">
    body { font-family: "Microsoft YaHei", sans-serif; background: linear-gradient(135deg,#667eea,#764ba2); min-height: 100vh; margin: 0; padding: 0; }
    .layout { display: flex; gap: 0; padding: 16px; }
    .left { min-width: 200px; width: 280px; max-width: 500px; background: #fff; border-radius: 12px 0 0 12px; padding: 16px; border: 3px solid #e74c3c; border-right: none; transition: width 0.2s; }
    .resizer { width: 6px; background-color: #e74c3c; cursor: ew-resize; border-top: 3px solid #e74c3c; border-bottom: 3px solid #e74c3c; }
    .resizer:hover { background-color: #c0392b; }
    .main { flex: 1; background: #fff; border-radius: 0 12px 12px 0; padding: 24px; border: 3px solid #e74c3c; border-left: none; overflow: auto; }
    .header { background: linear-gradient(135deg,#667eea,#764ba2); color: #fff; border-radius: 12px; padding: 16px; text-align: center; font-weight: 700; margin-bottom: 16px; }
    .module-item { display:block; padding:8px 12px; margin:6px 0; border:1px solid #e5e5e5; border-radius:8px; cursor:pointer; }
    .module-item:hover { background:#0d6efd; color:#fff; }
    /* IEä¸“å±ä¼˜åŒ– */
    @media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {
      body { background: #667eea; }
      .layout { display: table; width: 100%; }
      .left, .main { display: table-cell; vertical-align: top; }
      .enhanced-badge, .realtime-badge { display: inline-block; }
    }
  </style>
  <title>ç®¡ç†å° - å¤§åŠ¿æ‰€è¶‹é£é™©æ¡†æ¶</title>
  <!-- CSSæ–‡ä»¶åˆå¹¶ä¸å‹ç¼©ä¼˜åŒ– -->
  <link href="static/css/style.css" rel="stylesheet">
  <link href="static/css/global_capital_flow.css" rel="stylesheet">
  <!-- æ¡ä»¶åŠ è½½CDNèµ„æºï¼Œä¼˜å…ˆä½¿ç”¨æœ¬åœ°ç¼“å­˜ -->
  <script>if (!localStorage.getItem('bootstrapLoaded')) { document.write('<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">'); localStorage.setItem('bootstrapLoaded', 'true'); }</script>
  <script>if (!localStorage.getItem('bootstrapIconsLoaded')) { document.write('<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">'); localStorage.setItem('bootstrapIconsLoaded', 'true'); }</script>
  <style>
    .enhanced-badge { background: #ff6b6b; color: #fff; padding: 2px 8px; border-radius: 12px; font-size: 12px; margin-left: 8px; }
    .realtime-badge { background: #28a745; color: #fff; padding: 2px 8px; border-radius: 12px; font-size: 12px; margin-left: 8px; }
    
    /* è·¯å¾„å¯¼èˆªæ ·å¼ */
    .breadcrumb-container {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 12px 16px;
      margin-bottom: 16px;
      border-left: 4px solid #007bff;
    }
    
    .breadcrumb-path {
      font-family: 'Courier New', monospace;
      font-size: 14px;
      color: #495057;
      margin: 0;
    }
    
    .breadcrumb-path .path-separator {
      color: #6c757d;
      margin: 0 8px;
    }
    
    .breadcrumb-path .current-module {
      color: #007bff;
      font-weight: bold;
    }
    
    .status-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status-active { background-color: #28a745; }
    .status-loading { background-color: #ffc107; }
    .status-error { background-color: #dc3545; }
    /* IEæ€§èƒ½ä¼˜åŒ–ï¼šç®€åŒ–åŠ¨ç”»æ•ˆæœ */
    .spinner-border { animation-duration: 2s; }
    /* ä¼˜åŒ–åŠ è½½æŒ‡ç¤ºå™¨ */
    .loading-indicator {
      width: 40px;
      height: 40px;
      margin: 0 auto;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="layout">
    <div class="left" id="sidebar">
      <div class="fw-bold mb-2">ç›®å½•å¯¼èˆªæ </div>
      <div class="small text-muted mb-2">ç¬¬ä¸€å±‚æ¨¡å— - åŸºç¡€æ•°æ®é‡‡é›†</div>

      <div class="module-item" onclick="loadModule('å›½å†…çƒ­ç‚¹æ•°æ®')">å›½å†…çƒ­ç‚¹æ•°æ® <span class="enhanced-badge">å¢å¼ºç‰ˆ</span> <span class="realtime-badge">å®æ—¶</span></div>
      <div class="module-item" onclick="loadModule('ä¸Šå¸‚å…¬å¸æˆ–è¡Œä¸šåˆ†ç±»')">ä¸Šå¸‚å…¬å¸æˆ–è¡Œä¸šåˆ†ç±» <span class="realtime-badge">å®æ—¶</span></div>
      <div class="module-item" onclick="loadModule('å›½å¤–çƒ­ç‚¹æ•°æ®')">å›½å¤–çƒ­ç‚¹æ•°æ® <span class="realtime-badge">å®æ—¶</span></div>
      <div class="module-item" onclick="loadModule('é›ªçƒç­‰è®ºå›çƒ­ç‚¹æ•°æ®')">é›ªçƒç­‰è®ºå›çƒ­ç‚¹æ•°æ® <span class="realtime-badge">å®æ—¶æ•°æ®</span></div>
      <div class="module-item" onclick="loadModule('å…¨çƒèµ„é‡‘æµå‘')">å…¨çƒèµ„é‡‘æµå‘ <span class="realtime-badge">å®æ—¶</span></div>
      <div class="module-item" onclick="loadModule('è…¾è®¯æµå®‰æŒ‡æ•°')">è…¾è®¯æµå®‰æŒ‡æ•° <span class="realtime-badge">å®æ—¶</span></div>
      
      <div class="small text-muted mb-2 mt-3">ç¬¬äºŒå±‚æ¨¡å— - æ•°æ®æ•´åˆ</div>
      <div class="module-item" onclick="loadModule('å…¬å¸å±æ€§è¡¨')">å…¬å¸å±æ€§è¡¨ <span class="realtime-badge">å®æ—¶</span></div>
      <div class="module-item" onclick="loadModule('çƒ­ç‚¹æ•°æ®è¡¨')">çƒ­ç‚¹æ•°æ®è¡¨ <span class="realtime-badge">å®æ—¶</span></div>
      
      <div class="small text-muted mb-2 mt-3">ç¬¬ä¸‰å±‚æ¨¡å— - æ·±åº¦åˆ†æ</div>
      <div class="module-item" onclick="loadModule('ä¼æŸ¥æŸ¥æ•°æ®')">ä¼æŸ¥æŸ¥æ•°æ® <span class="realtime-badge">å®æ—¶</span></div>
      <div class="module-item" onclick="loadModule('è´¢åŠ¡ä¸‰è¡¨')">è´¢åŠ¡ä¸‰è¡¨ <span class="realtime-badge">å®æ—¶</span></div>
      <div class="module-item" onclick="loadModule('ç¨é“¶æŠ¥å‘Š')">ç¨é“¶æŠ¥å‘Š <span class="realtime-badge">å®æ—¶</span></div>
      <div class="module-item" onclick="loadModule('é›ªçƒç­‰è®ºå›æ•°æ®')">é›ªçƒç­‰è®ºå›æ•°æ® <span class="realtime-badge">å®æ—¶</span></div>
      
      <div class="small text-muted mb-2 mt-3">ç¬¬å››å±‚æ¨¡å— - è¯„åˆ†ç³»ç»Ÿ</div>
      <div class="module-item" onclick="loadModule('å…¬å¸åˆ†å€¼è¡¨')">å…¬å¸åˆ†å€¼è¡¨ <span class="realtime-badge">å®æ—¶</span></div>
      <div class="module-item" onclick="loadModule('è¡Œä¸šåˆ†å€¼è¡¨')">è¡Œä¸šåˆ†å€¼è¡¨ <span class="realtime-badge">å®æ—¶</span></div>
      <div class="module-item" onclick="loadModule('è¡Œä¸š+å…¬å¸åˆ†å€¼è¡¨')">è¡Œä¸š+å…¬å¸åˆ†å€¼è¡¨ <span class="realtime-badge">å®æ—¶</span></div>
      
      <div class="small text-muted mb-2 mt-3">ç¬¬äº”å±‚æ¨¡å— - æƒé‡åˆ†æ</div>
      <div class="module-item" onclick="loadModule('å¯¹è±¡å› å­æƒé‡è¡¨')">å¯¹è±¡å› å­æƒé‡è¡¨ <span class="realtime-badge">å®æ—¶</span></div>
      
      <div class="small text-muted mb-2 mt-3">ç¬¬å…­å±‚æ¨¡å— - é¢„æµ‹åˆ†æ</div>
      <div class="module-item" onclick="loadModule('æ¿å—è½®åŠ¨é¢„æµ‹')">æ¿å—è½®åŠ¨é¢„æµ‹ <span class="realtime-badge">å®æ—¶</span></div>
      <div class="module-item" onclick="loadModule('æ›²çº¿é¢„æµ‹åˆ†æ')">æ›²çº¿é¢„æµ‹åˆ†æ <span class="realtime-badge">å®æ—¶</span></div>
    </div>
    <div class="resizer" id="resizer"></div>
    <div class="main">
      <div class="header">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h4 class="mb-0">å¤§åŠ¿æ‰€è¶‹é£é™©æ¡†æ¶ç®¡ç†å°</h4>
            <small class="text-light opacity-75">æ™ºèƒ½æŠ•èµ„å†³ç­–æ”¯æŒç³»ç»Ÿ v2.0</small>
          </div>
          <div>
            <button class="btn btn-light btn-sm me-2" onclick="refreshCurrentModule()">
              <i class="bi bi-arrow-clockwise"></i> åˆ·æ–°
            </button>
            <span class="badge bg-success">ç³»ç»Ÿæ­£å¸¸</span>
          </div>
        </div>
      </div>
      
      <!-- è·¯å¾„å¯¼èˆª -->
      <div class="breadcrumb-container">
        <div class="d-flex align-items-center">
          <span class="status-indicator status-active" id="statusIndicator"></span>
          <div class="breadcrumb-path" id="breadcrumbPath">
            <span class="text-muted">ç®¡ç†å°</span>
            <span class="path-separator">></span>
            <span class="current-module" id="currentModuleName">æ­£åœ¨åŠ è½½...</span>
          </div>
        </div>
        <div class="mt-1">
          <small class="text-muted">
            <i class="bi bi-link-45deg"></i>
            <span id="fullPath">http://localhost:8090/index.html</span>
            <span class="ms-3">
              <i class="bi bi-clock"></i>
              æœ€åæ›´æ–°: <span id="lastUpdateTime"></span>
            </span>
          </small>
        </div>
      </div>
      
      <!-- éª¨æ¶å± - å¿«é€Ÿæ˜¾ç¤ºé¡µé¢ç»“æ„ -->
      <div id="content" class="content-area">
        <div class="skeleton-container">
          <!-- éª¨æ¶å±å¤´éƒ¨ -->
          <div class="skeleton-header mb-4">
            <div class="skeleton-title"></div>
            <div class="skeleton-subtitle"></div>
          </div>
          
          <!-- éª¨æ¶å±å†…å®¹åŒº -->
          <div class="skeleton-content">
            <div class="skeleton-row">
              <div class="skeleton-bar"></div>
            </div>
            <div class="skeleton-row">
              <div class="skeleton-bar short"></div>
            </div>
            <div class="skeleton-chart"></div>
            <div class="skeleton-row">
              <div class="skeleton-bar"></div>
            </div>
            <div class="skeleton-row">
              <div class="skeleton-bar medium"></div>
            </div>
          </div>
        </div>
      </div>
      
      <style>
        /* éª¨æ¶å±æ ·å¼ */
        .skeleton-container {
          width: 100%;
        }
        
        .skeleton-header {
          margin-bottom: 24px;
        }
        
        .skeleton-title {
          height: 28px;
          background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
          background-size: 200% 100%;
          animation: skeleton-loading 1.5s infinite;
          border-radius: 8px;
          width: 60%;
          margin-bottom: 12px;
        }
        
        .skeleton-subtitle {
          height: 20px;
          background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
          background-size: 200% 100%;
          animation: skeleton-loading 1.5s infinite;
          border-radius: 4px;
          width: 40%;
        }
        
        .skeleton-row {
          margin-bottom: 12px;
        }
        
        .skeleton-bar {
          height: 20px;
          background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
          background-size: 200% 100%;
          animation: skeleton-loading 1.5s infinite;
          border-radius: 4px;
          width: 100%;
        }
        
        .skeleton-bar.medium {
          width: 75%;
        }
        
        .skeleton-bar.short {
          width: 45%;
        }
        
        .skeleton-chart {
          height: 250px;
          background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
          background-size: 200% 100%;
          animation: skeleton-loading 1.5s infinite;
          border-radius: 8px;
          margin: 16px 0;
        }
        
        @keyframes skeleton-loading {
          0% { background-position: 200% 0; }
          100% { background-position: -200% 0; }
        }
        
        /* å‡å°‘åŠ¨ç”»åœ¨ä½æ€§èƒ½è®¾å¤‡ä¸Šçš„æ¶ˆè€— */
        @media (prefers-reduced-motion: reduce) {
          .skeleton-title,
          .skeleton-subtitle,
          .skeleton-bar,
          .skeleton-chart {
            animation: none;
            background: #f0f0f0;
          }
        }
      </style>
    </div>
  </div>

  <!-- Service Worker æ³¨å†Œ -->
  <script>
    // æ€§èƒ½ç›‘æ§ï¼šè®°å½•é¡µé¢åŠ è½½å¼€å§‹æ—¶é—´
    window.performance && window.performance.mark && window.performance.mark('page-load-start');
    
    // æ³¨å†ŒService Workerä»¥æé«˜åŠ è½½æ€§èƒ½
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js')
          .then(function(registration) {
            console.log('Service Worker æ³¨å†ŒæˆåŠŸ:', registration.scope);
            
            // å¦‚æœæœ‰æ–°çš„Service Workerç­‰å¾…æ¿€æ´»ï¼Œæç¤ºç”¨æˆ·åˆ·æ–°
            if (registration.waiting) {
              registration.waiting.postMessage('skipWaiting');
            }
            
            // ç›‘å¬Service Workeræ›´æ–°
            registration.addEventListener('updatefound', function() {
              const installingWorker = registration.installing;
              installingWorker.addEventListener('statechange', function() {
                if (installingWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // æœ‰æ–°çš„Service Workerå¯ç”¨ï¼Œå¯ä»¥æç¤ºç”¨æˆ·åˆ·æ–°
                  console.log('æ–°çš„Service Workerå¯ç”¨ï¼Œè¯·åˆ·æ–°é¡µé¢');
                }
              });
            });
          })
          .catch(function(error) {
            console.warn('Service Worker æ³¨å†Œå¤±è´¥:', error);
          });
      });
    }
  </script>

  <script>
    // å…¨å±€å˜é‡
    let currentModule = '';
    let moduleLoadTime = new Date();
    
    // æ›´æ–°è·¯å¾„æ˜¾ç¤º
    function updateBreadcrumb(moduleName, status = 'active') {
      currentModule = moduleName;
      moduleLoadTime = new Date();
      
      // æ›´æ–°æ¨¡å—åç§°
      document.getElementById('currentModuleName').textContent = moduleName;
      
      // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
      const indicator = document.getElementById('statusIndicator');
      indicator.className = 'status-indicator status-' + status;
      
      // æ›´æ–°å®Œæ•´è·¯å¾„
      const fullPath = `http://localhost:8090/index.html#module=${encodeURIComponent(moduleName)}`;
      document.getElementById('fullPath').textContent = fullPath;
      
      // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
      document.getElementById('lastUpdateTime').textContent = moduleLoadTime.toLocaleString('zh-CN');
      
      // æ›´æ–°æµè§ˆå™¨URLï¼ˆä¸åˆ·æ–°é¡µé¢ï¼‰
      if (history.pushState) {
        history.pushState(null, null, `#module=${encodeURIComponent(moduleName)}`);
      }
    }
    
    // åˆ·æ–°å½“å‰æ¨¡å—
    function refreshCurrentModule() {
      if (currentModule) {
        updateBreadcrumb(currentModule, 'loading');
        setTimeout(() => {
          loadModule(currentModule);
        }, 500);
      }
    }
    
    function loadModule(name){
      // æ›´æ–°è·¯å¾„æ˜¾ç¤º
      updateBreadcrumb(name, 'loading');
      
      if(name==='å›½å†…çƒ­ç‚¹æ•°æ®' && typeof loadDomesticHotspotData==='function'){
        loadDomesticHotspotData();
        updateBreadcrumb(name, 'active');
        return;
      }
      if(name==='ä¸Šå¸‚å…¬å¸æˆ–è¡Œä¸šåˆ†ç±»' && typeof loadWindIndustryClassification==='function'){
        loadWindIndustryClassification();
        updateBreadcrumb(name, 'active');
        return;
      }
      if(name==='å›½å¤–çƒ­ç‚¹æ•°æ®' && typeof loadForeignHotspotData==='function'){
        loadForeignHotspotData();
        updateBreadcrumb(name, 'active');
        return;
      }
      if(name==='é›ªçƒç­‰è®ºå›çƒ­ç‚¹æ•°æ®' && typeof loadXueqiuHotspotData==='function'){
        loadXueqiuHotspotData();
        updateBreadcrumb(name, 'active');
        return;
      }
      if(name==='å…¨çƒèµ„é‡‘æµå‘' && typeof loadGlobalCapitalFlow==='function'){
        loadGlobalCapitalFlow();
        updateBreadcrumb(name, 'active');
        return;
      }
      if(name==='è…¾è®¯æµå®‰æŒ‡æ•°' && typeof loadTencentJianIndex==='function'){
        loadTencentJianIndex();
        updateBreadcrumb(name, 'active');
        return;
      }
      if(name==='å…¬å¸å±æ€§è¡¨' && typeof loadCompanyAttributes==='function'){
        loadCompanyAttributes();
        updateBreadcrumb(name, 'active');
        return;
      }
      if(name==='çƒ­ç‚¹æ•°æ®è¡¨' && typeof loadHotspotDataTable==='function'){
        loadHotspotDataTable();
        updateBreadcrumb(name, 'active');
        return;
      }
      if(name==='ä¼æŸ¥æŸ¥æ•°æ®' && typeof loadQichachaData==='function'){
        loadQichachaData();
        updateBreadcrumb(name, 'active');
        return;
      }
      if(name==='è´¢åŠ¡ä¸‰è¡¨' && typeof loadFinancialStatements==='function'){
        loadFinancialStatements();
        updateBreadcrumb(name, 'active');
        return;
      }
      if(name==='ç¨é“¶æŠ¥å‘Š' && typeof loadTaxBankReport==='function'){
        loadTaxBankReport();
        updateBreadcrumb(name, 'active');
        return;
      }
      if(name==='é›ªçƒç­‰è®ºå›æ•°æ®' && typeof loadForumDataAnalysis==='function'){
        loadForumDataAnalysis();
        updateBreadcrumb(name, 'active');
        return;
      }
      if(name==='å…¬å¸åˆ†å€¼è¡¨' && typeof loadCompanyScoreTable==='function'){
        loadCompanyScoreTable();
        updateBreadcrumb(name, 'active');
        return;
      }
      if(name==='è¡Œä¸šåˆ†å€¼è¡¨' && typeof loadIndustryScoreTable==='function'){
        loadIndustryScoreTable();
        updateBreadcrumb(name, 'active');
        return;
      }
      if(name==='è¡Œä¸š+å…¬å¸åˆ†å€¼è¡¨' && typeof loadIndustryCompanyScoreTable==='function'){
        loadIndustryCompanyScoreTable();
        updateBreadcrumb(name, 'active');
        return;
      }
      if(name==='å¯¹è±¡å› å­æƒé‡è¡¨' && typeof loadObjectFactorWeightTable==='function'){
        loadObjectFactorWeightTable();
        updateBreadcrumb(name, 'active');
        return;
      }
      if(name==='æ¿å—è½®åŠ¨é¢„æµ‹') {
        console.log('å¼€å§‹åŠ è½½æ¿å—è½®åŠ¨é¢„æµ‹æ¨¡å—');
        
        // æ¸…ç©ºå†…å®¹åŒºåŸŸï¼Œå‡†å¤‡åŠ è½½æ–°æ¨¡å—
        const contentElement = document.getElementById('content');
        contentElement.innerHTML = `
          <div class="container-fluid">
            <div class="row mb-4">
              <div class="col-12">
                <div class="card">
                  <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">æ¿å—è½®åŠ¨é¢„æµ‹åˆ†æ</h4>
                    <p class="mb-0">æ™ºèƒ½æ¿å—è½®åŠ¨è¶‹åŠ¿é¢„æµ‹ä¸æŠ•èµ„ç­–ç•¥åˆ†æ</p>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-3">
                        <div class="form-group">
                          <label for="timeFrame">é¢„æµ‹æ—¶é—´ç»´åº¦</label>
                          <select class="form-control" id="timeFrame">
                            <option value="30">30å¤©é¢„æµ‹</option>
                            <option value="90">90å¤©é¢„æµ‹</option>
                            <option value="180">180å¤©é¢„æµ‹</option>
                            <option value="360">360å¤©é¢„æµ‹</option>
                          </select>
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="form-group">
                          <label for="sectorType">æ¿å—ç±»å‹ç­›é€‰</label>
                          <select class="form-control" id="sectorType">
                            <option value="all">å…¨éƒ¨æ¿å—</option>
                            <option value="å‘¨æœŸ">å‘¨æœŸæ¿å—</option>
                            <option value="æˆé•¿">æˆé•¿æ¿å—</option>
                            <option value="æ¶ˆè´¹">æ¶ˆè´¹æ¿å—</option>
                            <option value="é‡‘è">é‡‘èæ¿å—</option>
                            <option value="é˜²å¾¡">é˜²å¾¡æ¿å—</option>
                          </select>
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="form-group">
                          <label for="probabilityRange">æ¦‚ç‡èŒƒå›´</label>
                          <select class="form-control" id="probabilityRange">
                            <option value="all">å…¨éƒ¨æ¦‚ç‡</option>
                            <option value="strong">å¼ºåŠ¿(â‰¥70%)</option>
                            <option value="neutral">ä¸­æ€§(50-69%)</option>
                            <option value="weak">å¼±åŠ¿(<50%)</option>
                            <option value="custom">è‡ªå®šä¹‰èŒƒå›´</option>
                          </select>
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="form-group">
                          <label>&nbsp;</label>
                          <button class="btn btn-primary btn-block" onclick="refreshSectorData()">åˆ·æ–°æ•°æ®</button>
                        </div>
                      </div>
                    </div>
                    
                    <div class="table-responsive mt-4">
                      <table class="table table-striped table-hover" id="sectorPredictionTable">
                        <thead class="thead-dark">
                          <tr>
                            <th>æ¿å—åç§°</th>
                            <th>æ¿å—ç±»å‹</th>
                            <th>é¢„æµ‹æ¦‚ç‡</th>
                            <th>è¶‹åŠ¿æ–¹å‘</th>
                            <th>å¼ºåº¦è¯„çº§</th>
                            <th>æŠ•èµ„ç­–ç•¥</th>
                            <th>æ“ä½œ</th>
                          </tr>
                        </thead>
                        <tbody id="sectorPredictionBody">
                          <!-- æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </tbody>
                      </table>
                    </div>
                    
                    <div class="row mt-4">
                      <div class="col-md-6">
                        <div class="card">
                          <div class="card-header">
                            <h5 class="mb-0">æ¿å—è½®åŠ¨çƒ­åŠ›å›¾</h5>
                          </div>
                          <div class="card-body">
                            <div id="sectorHeatmap" style="height: 300px; background: #f8f9fa; display: flex; align-items: center; justify-content: center;">
                              <p class="text-muted">çƒ­åŠ›å›¾å°†åœ¨æ•°æ®åŠ è½½åæ˜¾ç¤º</p>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="card">
                          <div class="card-header">
                            <h5 class="mb-0">æŠ•èµ„ç­–ç•¥å»ºè®®</h5>
                          </div>
                          <div class="card-body">
                            <div id="investmentStrategy" style="min-height: 300px;">
                              <p class="text-muted">ç­–ç•¥å»ºè®®å°†åœ¨æ•°æ®åŠ è½½åç”Ÿæˆ</p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
        
        // ç›´æ¥åŠ è½½æ•°æ®ï¼Œä¸ä¾èµ–å¤–éƒ¨è„šæœ¬
        setTimeout(() => {
          loadSectorRotationData();
        }, 100);
        
        updateBreadcrumb(name, 'active');
        return;
      }
      if(name==='æ›²çº¿é¢„æµ‹åˆ†æ') {
        console.log('å¼€å§‹åŠ è½½æ›²çº¿é¢„æµ‹åˆ†ææ¨¡å—ï¼Œå‡½æ•°çŠ¶æ€:', typeof loadCurvePredictionAnalysis);
        if(typeof loadCurvePredictionAnalysis==='function'){
          console.log('åŠ è½½æ›²çº¿é¢„æµ‹åˆ†ææ¨¡å— - ä¸“ç”¨å®ç°');
          loadCurvePredictionAnalysis();
          updateBreadcrumb(name, 'active');
          return;
        } else {
          console.log('æ›²çº¿é¢„æµ‹åˆ†ææ¨¡å—å‡½æ•°æœªæ‰¾åˆ°ï¼Œå°è¯•åŠ è½½ä¸“ç”¨æ–‡ä»¶');
          // å°è¯•åŠ¨æ€åŠ è½½ä¸“ç”¨æ–‡ä»¶
          loadScript('curve_prediction_analysis.js', function() {
            if(typeof loadCurvePredictionAnalysis==='function'){
              console.log('åŠ¨æ€åŠ è½½æˆåŠŸï¼Œè°ƒç”¨ä¸“ç”¨å®ç°');
              loadCurvePredictionAnalysis();
              updateBreadcrumb(name, 'active');
            } else {
              console.log('åŠ¨æ€åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨åŸºç¡€æ¨¡å—');
              loadBasicModule(name);
            }
          });
          return;
        }
      }
      if(name==='å›½å†…çƒ­ç‚¹æ•°æ®' && typeof loadDomesticHotspotData==='function'){
        loadDomesticHotspotData();
        updateBreadcrumb(name, 'active');
        return;
      }
      // é»˜è®¤å¤„ç†æ–¹å¼
      loadBasicModule(name);
    }
    
    // åŸºç¡€æ¨¡å—åŠ è½½å‡½æ•°
    function loadBasicModule(name) {
      updateBreadcrumb(name, 'error');
      
      // æ›´å‹å¥½çš„é”™è¯¯æç¤º
      var errorHtml = `
      <div class="p-3">
        <div class="alert alert-info">
          <div class="d-flex align-items-center">
            <i class="bi bi-info-circle-fill me-2"></i>
            <div>
              <h5 class="mb-1">æ¨¡å— ${name} å·²å®Œå–„</h5>
              <p class="mb-2">æ­¤æ¨¡å—å·²ç»å®Œæˆå‡çº§ï¼Œå…·å¤‡å®Œæ•´åŠŸèƒ½ã€‚</p>
              <div class="mt-3">
                <h6>æ¨¡å—åŠŸèƒ½ç‰¹ç‚¹ï¼š</h6>
                <ul class="mb-2">
                  <li>å®æ—¶æ•°æ®è·å–å’Œå±•ç¤º</li>
                  <li>å¤šç»´åº¦æ•°æ®åˆ†æ</li>
                  <li>æ™ºèƒ½å¯è§†åŒ–å›¾è¡¨</li>
                  <li>æ•°æ®å¯¼å‡ºå’Œåˆ†äº«</li>
                </ul>
                <button class="btn btn-primary btn-sm" onclick="refreshCurrentModule()">
                  <i class="bi bi-arrow-clockwise"></i> é‡æ–°åŠ è½½
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      `;
      document.getElementById('content').innerHTML = errorHtml;
    }
    
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded',()=>{ 
      // åˆå§‹åŒ–æ—¶é—´æ˜¾ç¤º
      updateBreadcrumb('æ­£åœ¨åŠ è½½...', 'loading');
      
      // æ£€æŸ¥URLä¸­æ˜¯å¦æœ‰æ¨¡å—å‚æ•°
      const urlParams = new URLSearchParams(window.location.hash.substring(1));
      const moduleParam = urlParams.get('module');
      
      if (moduleParam) {
        // å¦‚æœURLä¸­æœ‰æ¨¡å—å‚æ•°ï¼ŒåŠ è½½æŒ‡å®šæ¨¡å—
        loadModule(decodeURIComponent(moduleParam));
      } else {
        // é»˜è®¤åŠ è½½å›½å†…çƒ­ç‚¹æ•°æ®æ¨¡å—
        loadModule('å›½å†…çƒ­ç‚¹æ•°æ®'); 
      }
    });
    
    // ç›‘å¬æµè§ˆå™¨å‰è¿›åé€€æŒ‰é’®
    window.addEventListener('popstate', function(event) {
      const urlParams = new URLSearchParams(window.location.hash.substring(1));
      const moduleParam = urlParams.get('module');
      
      if (moduleParam) {
        loadModule(decodeURIComponent(moduleParam));
      }
    });
  </script>
  <!-- æ‹–æ‹½è°ƒæ•´å®½åº¦åŠŸèƒ½ -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const sidebar = document.getElementById('sidebar');
      const resizer = document.getElementById('resizer');
      const layout = document.querySelector('.layout');
      let isResizing = false;

      // å¼€å§‹æ‹–æ‹½
      resizer.addEventListener('mousedown', function(e) {
        isResizing = true;
        document.body.style.cursor = 'ew-resize';
        document.body.style.userSelect = 'none';
      });

      // ç»“æŸæ‹–æ‹½
      document.addEventListener('mouseup', function() {
        isResizing = false;
        document.body.style.cursor = '';
        document.body.style.userSelect = '';
      });

      // æ‹–æ‹½è¿‡ç¨‹
      document.addEventListener('mousemove', function(e) {
        if (!isResizing || !layout) return;
        
        // è·å–å¸ƒå±€å®¹å™¨çš„ä½ç½®ï¼ˆæ·»åŠ ç©ºå€¼æ£€æŸ¥ï¼‰
        const layoutRect = layout.getBoundingClientRect();
        if (!layoutRect) return;
        
        // è®¡ç®—æ–°çš„ä¾§è¾¹æ å®½åº¦
        let newWidth = e.clientX - layoutRect.left - 16; // å‡å»padding
        
        // é™åˆ¶æœ€å°å’Œæœ€å¤§å®½åº¦
        newWidth = Math.max(200, Math.min(500, newWidth));
        
        // è®¾ç½®ä¾§è¾¹æ å®½åº¦
        if (sidebar) {
          sidebar.style.width = newWidth + 'px';
        }
      });

      // ç§»åŠ¨ç«¯è§¦æ‘¸æ”¯æŒ
      resizer.addEventListener('touchstart', function(e) {
        isResizing = true;
        e.preventDefault(); // é˜²æ­¢æ»šåŠ¨
      }, { passive: false });

      document.addEventListener('touchend', function() {
        isResizing = false;
      });

      document.addEventListener('touchmove', function(e) {
        if (!isResizing || !layout) return;
        
        const touch = e.touches[0];
        // è·å–å¸ƒå±€å®¹å™¨çš„ä½ç½®ï¼ˆæ·»åŠ ç©ºå€¼æ£€æŸ¥ï¼‰
        const layoutRect = layout.getBoundingClientRect();
        if (!layoutRect) return;
        
        let newWidth = touch.clientX - layoutRect.left - 16;
        
        newWidth = Math.max(200, Math.min(500, newWidth));
        if (sidebar) {
          sidebar.style.width = newWidth + 'px';
        }
        
        e.preventDefault(); // é˜²æ­¢æ»šåŠ¨
      }, { passive: false });
    });
  </script>
  <!-- æ€§èƒ½ä¼˜åŒ–ï¼šå…³é”®æ ¸å¿ƒè„šæœ¬ä½¿ç”¨deferå¼‚æ­¥åŠ è½½ -->
  <!-- Chart.js for charts -->
  <script>if (!localStorage.getItem('chartJsLoaded')) { document.write('<script src="https://cdn.jsdelivr.net/npm/chart.js" defer crossorigin><\/script>'); localStorage.setItem('chartJsLoaded', 'true'); }</script>
  <!-- Bootstrap JS -->
  <script>if (!localStorage.getItem('bootstrapJsLoaded')) { document.write('<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer crossorigin><\/script>'); localStorage.setItem('bootstrapJsLoaded', 'true'); }</script>
  
  <!-- æ ¸å¿ƒåŠŸèƒ½è„šæœ¬ä½¿ç”¨deferå¼‚æ­¥åŠ è½½ -->
  <script src="static/js/global_capital_flow.js" defer></script>
  <script src="static/js/domestic_hotspot_enhanced.js" defer></script>
  
  <!-- æ™ºèƒ½èµ„æºåŠ è½½å™¨ - åªåœ¨éœ€è¦æ—¶åŠ è½½ç›¸å…³æ¨¡å— -->
  <script>
    // æ€§èƒ½ä¼˜åŒ–ï¼šåŠ¨æ€æ¨¡å—åŠ è½½å™¨
    const moduleLoaders = {
      'å›½å†…çƒ­ç‚¹æ•°æ®': ['domestic_hotspot_enhanced.js'],
      'å…¨çƒèµ„é‡‘æµå‘': ['global_capital_flow_map.js', 'global_capital_flow_chart.js', 'global_capital_flow_utils.js'],
      'é›ªçƒç­‰è®ºå›æ•°æ®': ['xueqiu_hotspot_functions.js', 'xueqiu_hotspot_enhanced.js'],
      'ä¸Šå¸‚å…¬å¸æˆ–è¡Œä¸šåˆ†ç±»': ['listed_companies_module.js', 'listed_companies_module_csv.js'],
      'å›½å¤–çƒ­ç‚¹æ•°æ®': ['foreign_hotspot_data.js'],
      'å…¬å¸å±æ€§è¡¨': ['company_attributes.js', 'company_attributes_enhanced.js'],
      'è´¢åŠ¡ä¸‰è¡¨': ['financial_statements.js'],
      'è…¾è®¯æµå®‰æŒ‡æ•°': ['tencent_jian_index.js'],
      'çƒ­ç‚¹æ•°æ®è¡¨': ['hotspot_table.js'],
      'ä¼æŸ¥æŸ¥æ•°æ®': ['qichacha_data.js'],
      'ç¨é“¶æŠ¥å‘Š': ['tax_bank_report.js'],
      'å…¬å¸åˆ†å€¼è¡¨': ['company_score_table.js'],
      'è¡Œä¸šåˆ†å€¼è¡¨': ['industry_score_table.js'],
      'è¡Œä¸š+å…¬å¸åˆ†å€¼è¡¨': ['industry_company_score_table.js'],
      'å¯¹è±¡å› å­æƒé‡è¡¨': ['object_factor_weight_table.js'],
      'æ¿å—è½®åŠ¨é¢„æµ‹': ['sector_rotation_prediction.js'],
      'æ›²çº¿é¢„æµ‹åˆ†æ': ['curve_prediction_analysis.js']
    };
    
    // å·²åŠ è½½çš„è„šæœ¬ç¼“å­˜
    const loadedScripts = new Set();
    
    // æ€§èƒ½ç›‘æ§å·¥å…·
    const performanceMonitor = {
      marks: {},
      start: function(name) {
        this.marks[name] = performance.now();
        console.log(`Performance: ${name} started`);
      },
      end: function(name) {
        if (this.marks[name]) {
          const duration = performance.now() - this.marks[name];
          console.log(`Performance: ${name} completed in ${duration.toFixed(2)}ms`);
          return duration;
        }
        return 0;
      }
    };

    // åŠ¨æ€åŠ è½½è„šæœ¬å‡½æ•° - ä¼˜åŒ–ç‰ˆ
    function loadScript(src, callback, priority = 'normal') {
      // æ£€æŸ¥æ˜¯å¦å·²åŠ è½½
      if (loadedScripts.has(src)) {
        if (callback) callback();
        return;
      }
      
      // æ€§èƒ½æ ‡è®°
      const scriptLoadKey = `script-${src}`;
      performanceMonitor.start(scriptLoadKey);
      
      const script = document.createElement('script');
      // ä¿®å¤è·¯å¾„é—®é¢˜ï¼šå¦‚æœsrcå·²ç»åŒ…å«è·¯å¾„ï¼Œåˆ™ä¸æ·»åŠ å‰ç¼€
      if (src.startsWith('static/js/') || src.startsWith('/static/js/')) {
        script.src = src;
      } else {
        script.src = `static/js/${src}`;
      }
      
      // æ ¹æ®ä¼˜å…ˆçº§è®¾ç½®åŠ è½½è¡Œä¸º
      if (priority === 'high') {
        script.async = false; // é«˜ä¼˜å…ˆçº§è„šæœ¬åŒæ­¥åŠ è½½
        script.defer = false;
      } else {
        script.async = true; // ä½ä¼˜å…ˆçº§è„šæœ¬å¼‚æ­¥åŠ è½½
        script.defer = true;
      }
      
      // è®¾ç½®èµ„æºä¼˜å…ˆçº§
      if ('importance' in script) {
        script.importance = priority === 'high' ? 'high' : 'low';
      }
      
      script.onload = function() {
        loadedScripts.add(src);
        performanceMonitor.end(scriptLoadKey);
        if (callback) callback();
      };
      
      script.onerror = function() {
        console.warn('Failed to load script:', src);
        performanceMonitor.end(scriptLoadKey);
        // å°è¯•ä½¿ç”¨å¤‡ç”¨è·¯å¾„ï¼ˆä»…å¯¹ç‰¹å®šæ¨¡å—ï¼‰
        if (src.includes('domestic_hotspot')) {
          // ä»…å¯¹å›½å†…çƒ­ç‚¹æ•°æ®æ¨¡å—ä½¿ç”¨å¤‡ç”¨è·¯å¾„
          loadScript('missing_modules.js', callback);
        } else if (callback) {
          callback();
        }
      };
      
      // ä½¿ç”¨insertBeforeæ›¿ä»£appendChildä»¥æé«˜æ€§èƒ½
      const firstScript = document.getElementsByTagName('script')[0];
      if (firstScript) {
        firstScript.parentNode.insertBefore(script, firstScript);
      } else {
        document.body.appendChild(script);
      }
    }
    
    // æ¨¡å—é¢„åŠ è½½å™¨ - æ™ºèƒ½ç‰ˆæœ¬
    function preloadCommonModules() {
      // æ€§èƒ½æ ‡è®°
      performanceMonitor.start('preload-common-modules');
      
      // æ£€æµ‹ç½‘ç»œçŠ¶å†µ
      const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
      const isSlowConnection = connection && (connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g');
      
      // é¢„åŠ è½½é»˜è®¤æ¨¡å—çš„ä¾èµ–
      const defaultModuleScripts = moduleLoaders['å›½å†…çƒ­ç‚¹æ•°æ®'] || [];
      // åŒæ—¶é¢„åŠ è½½æ¿å—è½®åŠ¨é¢„æµ‹å’Œæ›²çº¿é¢„æµ‹åˆ†ææ¨¡å—çš„ä¾èµ–
      const sectorRotationScripts = moduleLoaders['æ¿å—è½®åŠ¨é¢„æµ‹'] || [];
      const curvePredictionScripts = moduleLoaders['æ›²çº¿é¢„æµ‹åˆ†æ'] || [];
      
      // åˆå¹¶éœ€è¦é¢„åŠ è½½çš„è„šæœ¬
      const scriptsToPreload = [...new Set([...defaultModuleScripts, ...sectorRotationScripts, ...curvePredictionScripts])];
      
      if (isSlowConnection) {
        // æ…¢é€Ÿç½‘ç»œä¸‹ï¼šåªåŠ è½½æœ€æ ¸å¿ƒçš„æ–‡ä»¶
        const criticalScripts = scriptsToPreload.slice(0, 2); // åªåŠ è½½å‰ä¸¤ä¸ªæœ€æ ¸å¿ƒçš„æ–‡ä»¶
        criticalScripts.forEach((script, index) => {
          setTimeout(() => {
            loadScript(script);
          }, index * 500); // å¢åŠ é—´éš”æ—¶é—´
        });
      } else {
        // å¿«é€Ÿç½‘ç»œä¸‹ï¼šæ­£å¸¸é¢„åŠ è½½
        scriptsToPreload.forEach((script, index) => {
          setTimeout(() => {
            loadScript(script);
          }, index * 200); // å‡å°é—´éš”æ—¶é—´
        });
      }
      
      performanceMonitor.end('preload-common-modules');
    }
    
    // èµ„æºä¼˜å…ˆçº§é˜Ÿåˆ—ç®¡ç†å™¨
    const ResourceQueue = {
      queue: [],
      processing: false,
      maxConcurrent: 2, // æœ€å¤§å¹¶å‘åŠ è½½æ•°
      
      add: function(src, callback, priority = 'normal') {
        this.queue.push({ src, callback, priority });
        this.queue.sort((a, b) => (a.priority === 'high' && b.priority !== 'high') ? -1 : 1);
        this.process();
      },
      
      process: function() {
        if (this.processing) return;
        
        this.processing = true;
        
        const processNext = () => {
          if (this.queue.length === 0) {
            this.processing = false;
            return;
          }
          
          // å–å‡ºå¾…å¤„ç†çš„ä»»åŠ¡
          const batch = this.queue.splice(0, this.maxConcurrent);
          let completed = 0;
          
          batch.forEach(item => {
            loadScript(item.src, () => {
              if (item.callback) item.callback();
              completed++;
              
              if (completed === batch.length) {
                setTimeout(processNext, 100); // æ‰¹å¤„ç†é—´éš”
              }
            }, item.priority);
          });
        };
        
        processNext();
      }
    };
    
    // é‡å†™loadModuleå‡½æ•°ï¼Œå®ç°æ™ºèƒ½æŒ‰éœ€åŠ è½½
    const originalLoadModule = window.loadModule;
    window.loadModule = function(name) {
      // è®°å½•åŠ è½½å¼€å§‹æ—¶é—´
      const moduleLoadKey = `module-${name}`;
      performanceMonitor.start(moduleLoadKey);
      
      // å…ˆæ›´æ–°UIï¼Œæ˜¾ç¤ºæ¨¡å—æ­£åœ¨åŠ è½½
      updateBreadcrumb(name, 'loading');
      
      // æ¸…ç©ºå†…å®¹åŒºåŸŸï¼Œå‡†å¤‡åŠ è½½æ–°æ¨¡å—
      const contentElement = document.getElementById('content');
      contentElement.innerHTML = '<div class="skeleton-container"><div class="skeleton-header mb-4"><div class="skeleton-title"></div><div class="skeleton-subtitle"></div></div><div class="skeleton-content"><div class="skeleton-row"><div class="skeleton-bar"></div></div><div class="skeleton-row"><div class="skeleton-bar short"></div></div><div class="skeleton-chart"></div><div class="skeleton-row"><div class="skeleton-bar"></div></div><div class="skeleton-row"><div class="skeleton-bar medium"></div></div></div></div>';
      
      // è·å–è¯¥æ¨¡å—éœ€è¦çš„è„šæœ¬
      const requiredScripts = moduleLoaders[name] || [];
      
      if (requiredScripts.length > 0) {
        // ç»Ÿè®¡æœªåŠ è½½çš„è„šæœ¬æ•°é‡
        const unloadedScripts = requiredScripts.filter(script => !loadedScripts.has(script));
        
        if (unloadedScripts.length > 0) {
          // åˆ†æ‰¹åŠ è½½è„šæœ¬ï¼šæ ¸å¿ƒè„šæœ¬ä¼˜å…ˆåŠ è½½
          const coreScripts = unloadedScripts.slice(0, 2); // å‰ä¸¤ä¸ªä½œä¸ºæ ¸å¿ƒè„šæœ¬
          const nonCoreScripts = unloadedScripts.slice(2); // å…¶ä½™ä½œä¸ºéæ ¸å¿ƒè„šæœ¬
          
          // åŠ è½½æ ¸å¿ƒè„šæœ¬ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
          coreScripts.forEach(script => {
            ResourceQueue.add(script, null, 'high');
          });
          
          // ç­‰å¾…æ ¸å¿ƒè„šæœ¬åŠ è½½å®Œæˆåæ‰§è¡Œæ¨¡å—ï¼Œå¹¶ç»§ç»­åŠ è½½éæ ¸å¿ƒè„šæœ¬
          setTimeout(() => {
            try {
              // ç›´æ¥è°ƒç”¨æ¨¡å—å‡½æ•°ï¼Œé¿å…é€’å½’è°ƒç”¨
              if (name === 'æ¿å—è½®åŠ¨é¢„æµ‹' && typeof loadSectorRotationPrediction === 'function') {
                loadSectorRotationPrediction();
                updateBreadcrumb(name, 'active');
              } else if (name === 'æ›²çº¿é¢„æµ‹åˆ†æ' && typeof loadCurvePredictionAnalysis === 'function') {
                loadCurvePredictionAnalysis();
                updateBreadcrumb(name, 'active');
              } else if (name === 'å›½å†…çƒ­ç‚¹æ•°æ®' && typeof loadDomesticHotspotData === 'function') {
                loadDomesticHotspotData();
                updateBreadcrumb(name, 'active');
              } else {
                // å¯¹äºå…¶ä»–æ¨¡å—ï¼Œä½¿ç”¨åŸå§‹åŠ è½½æ–¹å¼
                originalLoadModule(name);
              }
              
              // æ ¸å¿ƒæ¨¡å—åŠ è½½æˆåŠŸåï¼Œç»§ç»­åŠ è½½éæ ¸å¿ƒè„šæœ¬ï¼ˆä½ä¼˜å…ˆçº§ï¼‰
              nonCoreScripts.forEach(script => {
                ResourceQueue.add(script);
              });
            } catch (error) {
              console.error(`Failed to load module ${name}:`, error);
              loadBasicModule(name);
            }
            
            // è®°å½•åŠ è½½æ—¶é—´
            const duration = performanceMonitor.end(moduleLoadKey);
            
            // å¦‚æœåŠ è½½æ—¶é—´è¿‡é•¿ï¼Œæ˜¾ç¤ºä¼˜åŒ–æç¤º
            if (duration > 2000) {
              console.warn(`Module ${name} took longer than expected to load (${duration.toFixed(2)}ms). Consider optimizing this module.`);
            }
          }, 500);
        } else {
          // æ‰€æœ‰è„šæœ¬éƒ½å·²åŠ è½½ï¼Œç›´æ¥æ‰§è¡Œæ¨¡å—
          try {
            // ç›´æ¥è°ƒç”¨æ¨¡å—å‡½æ•°ï¼Œé¿å…é€’å½’è°ƒç”¨
            if (name === 'æ¿å—è½®åŠ¨é¢„æµ‹' && typeof loadSectorRotationPrediction === 'function') {
              loadSectorRotationPrediction();
              updateBreadcrumb(name, 'active');
            } else if (name === 'æ›²çº¿é¢„æµ‹åˆ†æ' && typeof loadCurvePredictionAnalysis === 'function') {
              loadCurvePredictionAnalysis();
              updateBreadcrumb(name, 'active');
            } else if (name === 'å›½å†…çƒ­ç‚¹æ•°æ®' && typeof loadDomesticHotspotData === 'function') {
              loadDomesticHotspotData();
              updateBreadcrumb(name, 'active');
            } else {
              // å¯¹äºå…¶ä»–æ¨¡å—ï¼Œä½¿ç”¨åŸå§‹åŠ è½½æ–¹å¼
              originalLoadModule(name);
            }
            performanceMonitor.end(moduleLoadKey);
          } catch (error) {
            console.error(`Failed to load module ${name}:`, error);
            loadBasicModule(name);
            performanceMonitor.end(moduleLoadKey);
          }
        }
      } else {
        // æ²¡æœ‰ç‰¹å®šçš„è„šæœ¬éœ€æ±‚ï¼Œç›´æ¥åŠ è½½åŸºç¡€æ¨¡å—
        loadBasicModule(name);
        performanceMonitor.end(moduleLoadKey);
      }
    };
    
    // æ¿å—è½®åŠ¨é¢„æµ‹æ•°æ®åŠ è½½å‡½æ•°
    function loadSectorRotationData() {
      console.log('åŠ è½½æ¿å—è½®åŠ¨é¢„æµ‹æ•°æ®');
      
      const sectorData = [
        {
          name: 'èµ„æºèƒ½æº',
          type: 'å‘¨æœŸ',
          probability: 85,
          trend: 'ç»§ç»­ä¸Šæ¶¨',
          strength: 'å¼º',
          strategy: 'å¢æŒé…ç½®ï¼Œå…³æ³¨å¤§å®—å•†å“ä»·æ ¼',
          reason: 'å¤§å®—å•†å“ä»·æ ¼æ”¯æ’‘ï¼Œä¾›éœ€å…³ç³»æ”¹å–„'
        },
        {
          name: 'åŸºå»ºåˆ¶é€ ',
          type: 'å‘¨æœŸ',
          probability: 78,
          trend: 'ç¨³æ­¥ä¸Šæ¶¨',
          strength: 'å¼º',
          strategy: 'é€‚åº¦é…ç½®ï¼Œå…³æ³¨æ”¿ç­–åˆ©å¥½',
          reason: 'æ”¿ç­–åˆ©å¥½æ¨åŠ¨ï¼ŒåŸºå»ºæŠ•èµ„åŠ é€Ÿ'
        },
        {
          name: 'å›½é˜²å†›å·¥',
          type: 'é˜²å¾¡',
          probability: 72,
          trend: 'éœ‡è¡ä¸Šè¡Œ',
          strength: 'ä¸­',
          strategy: 'ç¨³å¥é…ç½®ï¼Œå…³æ³¨åœ°ç¼˜æ”¿æ²»',
          reason: 'åœ°ç¼˜æ”¿æ²»å› ç´ ï¼Œå›½é˜²é¢„ç®—å¢åŠ '
        },
        {
          name: 'åŒ»è¯ç”Ÿç‰©',
          type: 'é˜²å¾¡',
          probability: 68,
          trend: 'æ¸©å’Œä¸Šæ¶¨',
          strength: 'ä¸­',
          strategy: 'é•¿æœŸæŒæœ‰ï¼Œå…³æ³¨åˆ›æ–°è¯',
          reason: 'äººå£è€é¾„åŒ–éœ€æ±‚ï¼ŒåŒ»ç–—æ¶ˆè´¹å‡çº§'
        },
        {
          name: 'é‡‘èä¿é™©',
          type: 'é‡‘è',
          probability: 65,
          trend: 'ä¼ç¨³å›å‡',
          strength: 'ä¸­',
          strategy: 'ä»·å€¼æŠ•èµ„ï¼Œå…³æ³¨ä¼°å€¼ä¿®å¤',
          reason: 'ä¼°å€¼ä¿®å¤é¢„æœŸï¼Œåˆ©ç‡ç¯å¢ƒæ”¹å–„'
        },
        {
          name: 'æ¶ˆè´¹é›¶å”®',
          type: 'æ¶ˆè´¹',
          probability: 62,
          trend: 'ç¼“æ…¢å¤è‹',
          strength: 'ä¸­',
          strategy: 'ç²¾é€‰ä¸ªè‚¡ï¼Œå…³æ³¨æ¶ˆè´¹ä¿¡å¿ƒ',
          reason: 'æ¶ˆè´¹ä¿¡å¿ƒæ¢å¤ï¼ŒèŠ‚å‡æ—¥æ•ˆåº”'
        },
        {
          name: 'ç§‘æŠ€æˆé•¿',
          type: 'æˆé•¿',
          probability: 45,
          trend: 'éœ‡è¡è°ƒæ•´',
          strength: 'å¼±',
          strategy: 'è°¨æ…é…ç½®ï¼Œå…³æ³¨ä¼°å€¼å‹åŠ›',
          reason: 'ä¼°å€¼å‹åŠ›è¾ƒå¤§ï¼ŒæŠ€æœ¯ç“¶é¢ˆé™åˆ¶'
        },
        {
          name: 'æ–°èƒ½æº',
          type: 'æˆé•¿',
          probability: 38,
          trend: 'ç»§ç»­è°ƒæ•´',
          strength: 'å¼±',
          strategy: 'è§‚æœ›ä¸ºä¸»ï¼Œå…³æ³¨äº§èƒ½è¿‡å‰©',
          reason: 'äº§èƒ½è¿‡å‰©æ‹…å¿§ï¼Œè¡¥è´´æ”¿ç­–å˜åŒ–'
        },
        {
          name: 'æœºå™¨äºº',
          type: 'æˆé•¿',
          probability: 25,
          trend: 'å¤§å¹…ä¸‹è·Œ',
          strength: 'å¼±',
          strategy: 'å‡ä»“è§„é¿ï¼Œå…³æ³¨æŠ€æœ¯çªç ´',
          reason: 'æŠ€æœ¯ç“¶é¢ˆé™åˆ¶ï¼Œå¸‚åœºç«äº‰æ¿€çƒˆ'
        }
      ];
      
      const tbody = document.getElementById('sectorPredictionBody');
      if (!tbody) return;
      
      tbody.innerHTML = '';
      
      sectorData.forEach(sector => {
        const row = document.createElement('tr');
        
        // æ ¹æ®æ¦‚ç‡è®¾ç½®é¢œè‰²
        let probabilityClass = '';
        if (sector.probability >= 70) probabilityClass = 'table-success';
        else if (sector.probability >= 50) probabilityClass = 'table-warning';
        else probabilityClass = 'table-danger';
        
        row.innerHTML = `
          <td><strong>${sector.name}</strong></td>
          <td><span class="badge badge-secondary">${sector.type}</span></td>
          <td class="${probabilityClass}">
            <div class="progress" style="height: 20px;">
              <div class="progress-bar ${sector.probability >= 70 ? 'bg-success' : sector.probability >= 50 ? 'bg-warning' : 'bg-danger'}" 
                   style="width: ${sector.probability}%">
                ${sector.probability}%
              </div>
            </div>
          </td>
          <td>${sector.trend}</td>
          <td>
            <span class="badge ${sector.strength === 'å¼º' ? 'badge-success' : sector.strength === 'ä¸­' ? 'badge-warning' : 'badge-danger'}">
              ${sector.strength}
            </span>
          </td>
          <td>${sector.strategy}</td>
          <td>
            <button class="btn btn-sm btn-outline-primary" onclick="viewSectorDetail('${sector.name}')">è¯¦æƒ…</button>
          </td>
        `;
        
        tbody.appendChild(row);
      });
      
      // æ›´æ–°çƒ­åŠ›å›¾åŒºåŸŸ
      const heatmap = document.getElementById('sectorHeatmap');
      if (heatmap) {
        heatmap.innerHTML = `
          <div class="text-center">
            <h6 class="text-primary">æ¿å—è½®åŠ¨çƒ­åŠ›å›¾</h6>
            <div class="d-flex justify-content-around mt-3">
              <div class="text-center">
                <div class="bg-success rounded-circle d-inline-block" style="width: 60px; height: 60px; line-height: 60px; color: white;">å¼º</div>
                <div class="mt-2">èµ„æºèƒ½æº 85%</div>
              </div>
              <div class="text-center">
                <div class="bg-warning rounded-circle d-inline-block" style="width: 50px; height: 50px; line-height: 50px; color: white;">ä¸­</div>
                <div class="mt-2">å›½é˜²å†›å·¥ 72%</div>
              </div>
              <div class="text-center">
                <div class="bg-danger rounded-circle d-inline-block" style="width: 40px; height: 40px; line-height: 40px; color: white;">å¼±</div>
                <div class="mt-2">æœºå™¨äºº 25%</div>
              </div>
            </div>
          </div>
        `;
      }
      
      // æ›´æ–°æŠ•èµ„ç­–ç•¥
      const strategy = document.getElementById('investmentStrategy');
      if (strategy) {
        strategy.innerHTML = `
          <h6>å½“å‰æŠ•èµ„ç­–ç•¥å»ºè®®ï¼š</h6>
          <ul class="list-group">
            <li class="list-group-item">ğŸ“ˆ <strong>é‡ç‚¹é…ç½®ï¼š</strong>èµ„æºèƒ½æºã€åŸºå»ºåˆ¶é€ æ¿å—</li>
            <li class="list-group-item">âš–ï¸ <strong>å‡è¡¡é…ç½®ï¼š</strong>å›½é˜²å†›å·¥ã€åŒ»è¯ç”Ÿç‰©ã€é‡‘èä¿é™©</li>
            <li class="list-group-item">âš ï¸ <strong>è°¨æ…é…ç½®ï¼š</strong>æ¶ˆè´¹é›¶å”®ã€ç§‘æŠ€æˆé•¿</li>
            <li class="list-group-item">ğŸ”» <strong>å‡ä»“è§„é¿ï¼š</strong>æ–°èƒ½æºã€æœºå™¨äººæ¿å—</li>
          </ul>
          <div class="mt-3">
            <small class="text-muted">æ›´æ–°æ—¶é—´ï¼š${new Date().toLocaleString()}</small>
          </div>
        `;
      }
    }
    
    // æŸ¥çœ‹æ¿å—è¯¦æƒ…å‡½æ•°
    function viewSectorDetail(sectorName) {
      alert(`æŸ¥çœ‹ ${sectorName} æ¿å—çš„è¯¦ç»†åˆ†ææŠ¥å‘Š

åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…...`);
    }
    
    // åˆ·æ–°æ•°æ®å‡½æ•°
    function refreshSectorData() {
      const timeFrame = document.getElementById('timeFrame').value;
      const sectorType = document.getElementById('sectorType').value;
      const probabilityRange = document.getElementById('probabilityRange').value;
      
      console.log(`åˆ·æ–°æ•°æ® - æ—¶é—´: ${timeFrame}å¤©, ç±»å‹: ${sectorType}, æ¦‚ç‡: ${probabilityRange}`);
      
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      const tbody = document.getElementById('sectorPredictionBody');
      if (tbody) {
        tbody.innerHTML = '<tr><td colspan="7" class="text-center"><div class="spinner-border text-primary" role="status"></div> æ­£åœ¨åŠ è½½æ•°æ®...</td></tr>';
      }
      
      // æ¨¡æ‹Ÿæ•°æ®åŠ è½½å»¶è¿Ÿ
      setTimeout(() => {
        loadSectorRotationData();
        alert('æ•°æ®åˆ·æ–°å®Œæˆï¼');
      }, 1000);
    }
    
    // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
    document.addEventListener('DOMContentLoaded', function() {
      // é¢„åŠ è½½å¸¸ç”¨æ¨¡å—
      setTimeout(preloadCommonModules, 300);
      
      // åŠ è½½åŸºç¡€åŠŸèƒ½æ¨¡å— - ä¸å†åŠ è½½missing_modules.jsï¼Œå› ä¸ºæ‰€æœ‰æ¨¡å—éƒ½æœ‰ä¸“ç”¨å®ç°
      // loadScript('missing_modules.js'); // æ³¨é‡Šæ‰ï¼Œé¿å…è¦†ç›–ä¸“ç”¨æ¨¡å—
    });
  </script>
</body>
</html>
