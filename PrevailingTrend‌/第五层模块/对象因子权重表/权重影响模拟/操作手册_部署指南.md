# 部署指南

## 1. 环境要求

- Python 3.8+
- 依赖包：
  - numpy
  - pandas
  - matplotlib
  - seaborn
  - flask
  - flask-cors

## 2. 安装步骤

1. 安装依赖包：
```bash
pip install numpy pandas matplotlib seaborn flask flask-cors
```

2. 准备数据文件：
   - 在 `data` 目录下创建 `industry_data.csv` 和 `company_data.csv` 文件
   - 可选：创建 `weight_config.json` 文件，如果不存在则使用默认配置

3. 启动API服务器：
```bash
python -m 权重影响模拟.api_server
```

## 3. 配置说明

### 3.1 数据文件格式

#### 行业数据 (industry_data.csv)

```csv
industry_code,industry_name,revenue_growth,profit_margin,debt_ratio,cash_flow,price_momentum,volatility,liquidity,analyst_rating,social_media,news_sentiment,industry_growth,industry_concentration
BK0001,农林牧渔,0.85,0.72,0.65,0.78,0.62,0.45,0.55,0.68,0.72,0.65,0.82,0.45
BK0002,采掘,0.65,0.85,0.45,0.62,0.78,0.65,0.72,0.55,0.45,0.72,0.65,0.82
...
```

#### 公司数据 (company_data.csv)

```csv
company_code,company_name,industry_code,industry_name,revenue_growth,profit_margin,debt_ratio,cash_flow,price_momentum,volatility,liquidity,analyst_rating,social_media,news_sentiment,industry_growth,industry_concentration
000001,平安银行,BK0475,银行,0.85,0.72,0.65,0.78,0.62,0.45,0.55,0.68,0.72,0.65,0.82,0.45
000002,万科A,BK0451,房地产,0.65,0.85,0.45,0.62,0.78,0.65,0.72,0.55,0.45,0.72,0.65,0.82
...
```

### 3.2 权重配置 (weight_config.json)

```json
{
  "fundamental": {
    "revenue_growth": 0.15,
    "profit_margin": 0.15,
    "debt_ratio": 0.10,
    "cash_flow": 0.10
  },
  "market": {
    "price_momentum": 0.10,
    "volatility": 0.05,
    "liquidity": 0.05
  },
  "sentiment": {
    "analyst_rating": 0.10,
    "social_media": 0.05,
    "news_sentiment": 0.05
  },
  "industry": {
    "industry_growth": 0.10,
    "industry_concentration": 0.05
  }
}
```

## 4. 服务器配置

### 4.1 开发环境

```python
from 权重影响模拟 import run_server

# 启动开发服务器
run_server(host='127.0.0.1', port=5000, debug=True)
```

### 4.2 生产环境

推荐使用 Gunicorn 或 uWSGI 作为 WSGI 服务器，配合 Nginx 作为反向代理。

#### Gunicorn 配置示例

```bash
# 安装 Gunicorn
pip install gunicorn

# 启动服务
gunicorn -w 4 -b 0.0.0.0:5000 权重影响模拟.api_server:create_app()
```

#### Nginx 配置示例

```nginx
server {
    listen 80;
    server_name example.com;

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### 4.3 Docker 部署

#### Dockerfile

```dockerfile
FROM python:3.9-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 5000

CMD ["gunicorn", "-w", "4", "-b", "0.0.0.0:5000", "权重影响模拟.api_server:create_app()"]
```

#### requirements.txt

```
numpy==1.21.0
pandas==1.3.0
matplotlib==3.4.2
seaborn==0.11.1
flask==2.0.1
flask-cors==3.0.10
gunicorn==20.1.0
```

#### 构建和运行

```bash
# 构建镜像
docker build -t weight-simulator .

# 运行容器
docker run -d -p 5000:5000 --name weight-simulator-app weight-simulator