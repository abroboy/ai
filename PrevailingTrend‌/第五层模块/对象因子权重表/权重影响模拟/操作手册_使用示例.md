# 使用示例

## 1. 基本使用

### 1.1 初始化权重模拟器

```python
from 权重影响模拟 import WeightSimulator

# 创建权重模拟器
simulator = WeightSimulator()

# 查看当前权重配置
print(simulator.weight_config)
```

### 1.2 模拟行业排名

```python
# 定义权重调整
weight_adjustments = {
    'fundamental.revenue_growth': 0.20,  # 增加营收增长权重
    'industry.industry_growth': 0.05     # 减少行业增长权重
}

# 模拟行业排名
result = simulator.simulate_industry_ranking(weight_adjustments)

# 查看模拟结果
simulation_id = result['simulation_id']
df = result['result']

# 显示前10名行业
print(df[['industry_code', 'industry_name', 'total_score', 'rank']].head(10))
```

### 1.3 模拟公司排名

```python
# 模拟特定行业内的公司排名
industry_code = 'BK0001'  # 农林牧渔
result = simulator.simulate_company_ranking(industry_code, weight_adjustments)

# 查看模拟结果
simulation_id = result['simulation_id']
df = result['result']

# 显示前10名公司
print(df[['company_code', 'company_name', 'total_score', 'rank']].head(10))

# 模拟全市场公司排名
result_all = simulator.simulate_company_ranking(weight_adjustments=weight_adjustments)
df_all = result_all['result']
```

### 1.4 比较模拟结果

```python
# 创建另一个模拟
weight_adjustments2 = {
    'fundamental.profit_margin': 0.20,   # 增加利润率权重
    'fundamental.revenue_growth': 0.15   # 减少营收增长权重
}
result2 = simulator.simulate_industry_ranking(weight_adjustments2)
simulation_id2 = result2['simulation_id']

# 比较两个模拟结果
compare_results = simulator.compare_industry_simulations([simulation_id, simulation_id2])

# 分析排名变化
base_result = compare_results['base']['result']
sim_result = compare_results['sim_1']['result']
changes = compare_results['sim_1']['changes']

# 找出排名变化显著的行业
significant_changes = changes[changes['rank_change'].abs() >= 3]
print("排名变化显著的行业:")
print(significant_changes[['industry_code', 'rank_base', f'rank_1', 'rank_change']])
```

### 1.5 可视化结果

```python
# 可视化行业排名
plt = simulator.visualize_industry_ranking(simulation_id, top_n=15)
plt.show()

# 可视化公司排名
plt = simulator.visualize_company_ranking(result_all['simulation_id'], top_n=15)
plt.show()

# 可视化权重调整对特定行业的影响
industry_code = significant_changes['industry_code'].iloc[0]
plt = simulator.visualize_weight_impact([simulation_id, simulation_id2], industry_code, is_industry=True)
plt.show()
```

## 2. API服务器使用

### 2.1 启动API服务器

```python
from 权重影响模拟 import run_server

# 启动API服务器
run_server(host='0.0.0.0', port=5000, debug=True)
```

### 2.2 使用API接口

```python
import requests
import json

# 获取当前权重配置
response = requests.get('http://localhost:5000/api/weights')
weights = response.json()['data']
print(weights)

# 模拟行业排名
response = requests.post(
    'http://localhost:5000/api/industry/simulate',
    json={
        'weight_adjustments': {
            'fundamental.revenue_growth': 0.20,
            'industry.industry_growth': 0.05
        }
    }
)
result = response.json()
simulation_id = result['simulation_id']
print(f"模拟ID: {simulation_id}")

# 获取行业排名图表
chart_response = requests.get(f'http://localhost:5000/api/industry/chart/{simulation_id}?top_n=10')
with open('industry_ranking.png', 'wb') as f:
    f.write(chart_response.content)