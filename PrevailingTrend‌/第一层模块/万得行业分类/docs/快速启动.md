# ä¸‡å¾—è¡Œä¸šåˆ†ç±»æ¨¡å— - å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ðŸš€ 5åˆ†é’Ÿå¿«é€Ÿå¯åŠ¨

### å‰ç½®æ¡ä»¶
- Python 3.8+ å·²å®‰è£…
- MySQL æ•°æ®åº“å·²è¿è¡Œ
- ä¸‡å¾—Windç»ˆç«¯å·²å®‰è£…ï¼ˆæŽ¨èï¼‰æˆ–å‡†å¤‡ä½¿ç”¨å…è´¹æ•°æ®æº
- ç½‘ç»œè¿žæŽ¥æ­£å¸¸

### æ­¥éª¤1ï¼šçŽ¯å¢ƒå‡†å¤‡ (2åˆ†é’Ÿ)
```bash
# 1. è¿›å…¥æ¨¡å—ç›®å½•
cd "ç¬¬ä¸€å±‚æ¨¡å—/ä¸‡å¾—è¡Œä¸šåˆ†ç±»"

# 2. åˆ›å»ºè™šæ‹ŸçŽ¯å¢ƒ
python -m venv venv

# 3. æ¿€æ´»è™šæ‹ŸçŽ¯å¢ƒ
# Windows:
venv\Scripts\activate
# Linux/Mac:
# source venv/bin/activate

# 4. å®‰è£…ä¾èµ–
pip install WindPy tushare akshare pandas requests mysql-connector-python schedule
```

### æ­¥éª¤2ï¼šæ•°æ®åº“åˆå§‹åŒ– (1åˆ†é’Ÿ)
```bash
# 1. è¿›å…¥æ•°æ®åº“é…ç½®ç›®å½•
cd "../../æ•°æ®åº“é…ç½®"

# 2. è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–
python init_tables.py

# 3. éªŒè¯è¡¨åˆ›å»º
python -c "
import sys
sys.path.append('.')
from database_config import get_database_manager
db = get_database_manager()
db.connect()
result = db.execute_query('SHOW TABLES LIKE \"%industry%\"')
print('è¡Œä¸šç›¸å…³è¡¨:', result)
db.disconnect()
"
```

### æ­¥éª¤3ï¼šæµ‹è¯•æ•°æ®æºè¿žæŽ¥ (2åˆ†é’Ÿ)
```bash
# 1. å›žåˆ°æ¨¡å—ç›®å½•
cd "../ç¬¬ä¸€å±‚æ¨¡å—/ä¸‡å¾—è¡Œä¸šåˆ†ç±»"

# 2. æµ‹è¯•ä¸‡å¾—è¿žæŽ¥ï¼ˆå¦‚æžœæœ‰Windç»ˆç«¯ï¼‰
python -c "
try:
    from WindPy import w
    w.start()
    if w.isconnected():
        print('âœ… ä¸‡å¾—Windè¿žæŽ¥æˆåŠŸ')
    else:
        print('âŒ ä¸‡å¾—Windè¿žæŽ¥å¤±è´¥')
except ImportError:
    print('âš ï¸ ä¸‡å¾—Windæœªå®‰è£…ï¼Œå°†ä½¿ç”¨å…è´¹æ•°æ®æº')
"

# 3. æµ‹è¯•å…è´¹æ•°æ®æº
python -c "
import tushare as ts
import akshare as ak
print('âœ… Tushareç‰ˆæœ¬:', ts.__version__)
print('âœ… AKShareç‰ˆæœ¬:', ak.__version__)
# æµ‹è¯•èŽ·å–è¡Œä¸šæ•°æ®
try:
    df = ak.stock_board_industry_summary_ths()
    print(f'âœ… æˆåŠŸèŽ·å–{len(df)}ä¸ªè¡Œä¸šæ¿å—æ•°æ®')
except Exception as e:
    print(f'âŒ æ•°æ®èŽ·å–å¤±è´¥: {e}')
"
```

## ðŸ“ å¿…éœ€çš„æ–‡ä»¶

### æ ¸å¿ƒæ–‡ä»¶æ¸…å•
- `config.py` (é…ç½®æ–‡ä»¶)
- `requirements.txt` (ä¾èµ–åŒ…åˆ—è¡¨)
- `industry_collector.py` (è¡Œä¸šæ•°æ®é‡‡é›†å™¨)
- `industry_mapper.py` (è¡Œä¸šåˆ†ç±»æ˜ å°„å™¨)
- `scheduler.py` (å®šæ—¶ä»»åŠ¡)
- `test_industry.py` (æ•°æ®éªŒè¯è„šæœ¬)

### å¿«é€Ÿåˆ›å»ºé…ç½®æ–‡ä»¶
```python
# config.py
"""
ä¸‡å¾—è¡Œä¸šåˆ†ç±»æ¨¡å—é…ç½®
"""
import os

# æ•°æ®åº“é…ç½®
DATABASE_CONFIG = {
    'host': 'localhost',
    'port': 3306,
    'user': 'root',
    'password': 'your_password',
    'database': 'prevailing_trend',
    'charset': 'utf8mb4'
}

# ä¸‡å¾—Windé…ç½®
WIND_CONFIG = {
    'timeout': 30,
    'retry_count': 3,
    'retry_interval': 5
}

# Tushareé…ç½®
TUSHARE_TOKEN = "your_tushare_token"  # åœ¨ https://tushare.pro æ³¨å†ŒèŽ·å–

# æ•°æ®é‡‡é›†é…ç½®
COLLECTION_CONFIG = {
    'update_frequency': 'quarterly',  # å­£åº¦æ›´æ–°
    'batch_size': 1000,
    'concurrent_requests': 3,
    'request_interval': 1  # ç§’
}

# è¡Œä¸šåˆ†ç±»æ ‡å‡†ä¼˜å…ˆçº§
INDUSTRY_SOURCE_PRIORITY = [
    'wind',      # ä¸‡å¾—åˆ†ç±»ï¼ˆä¼˜å…ˆï¼‰
    'shenwan',   # ç”³ä¸‡åˆ†ç±»
    'csrc',      # è¯ç›‘ä¼šåˆ†ç±»
    'tushare'    # Tushareåˆ†ç±»ï¼ˆå¤‡ç”¨ï¼‰
]

# æ—¥å¿—é…ç½®
LOG_CONFIG = {
    'level': 'INFO',
    'format': '%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    'file_path': 'industry_collector.log'
}
```

## ðŸƒâ€â™‚ï¸ ä¸€é”®è¿è¡Œè„šæœ¬

### Windowsæ‰¹å¤„ç†è„šæœ¬ (run_industry.bat)
```batch
@echo off
echo å¯åŠ¨ä¸‡å¾—è¡Œä¸šåˆ†ç±»æ•°æ®é‡‡é›†ç³»ç»Ÿ...

REM æ¿€æ´»è™šæ‹ŸçŽ¯å¢ƒ
call venv\Scripts\activate

REM æ£€æŸ¥ä¾èµ–
python -c "import WindPy, tushare, akshare, pandas, mysql.connector; print('ä¾èµ–åŒ…æ£€æŸ¥é€šè¿‡')" || (
    echo æ­£åœ¨å®‰è£…ä¾èµ–...
    pip install WindPy tushare akshare pandas mysql-connector-python schedule
)

REM è¿è¡Œè¡Œä¸šæ•°æ®é‡‡é›†
echo å¼€å§‹è¡Œä¸šåˆ†ç±»æ•°æ®é‡‡é›†...
python industry_collector.py

REM éªŒè¯æ•°æ®
echo éªŒè¯é‡‡é›†æ•°æ®...
python test_industry.py

echo ä»»åŠ¡å®Œæˆï¼
pause
```

### Linux/Macè„šæœ¬ (run_industry.sh)
```bash
#!/bin/bash
echo "å¯åŠ¨ä¸‡å¾—è¡Œä¸šåˆ†ç±»æ•°æ®é‡‡é›†ç³»ç»Ÿ..."

# æ¿€æ´»è™šæ‹ŸçŽ¯å¢ƒ
source venv/bin/activate

# æ£€æŸ¥ä¾èµ–
python -c "import tushare, akshare, pandas, mysql.connector; print('ä¾èµ–åŒ…æ£€æŸ¥é€šè¿‡')" || {
    echo "æ­£åœ¨å®‰è£…ä¾èµ–..."
    pip install tushare akshare pandas mysql-connector-python schedule
}

# è¿è¡Œè¡Œä¸šæ•°æ®é‡‡é›†
echo "å¼€å§‹è¡Œä¸šåˆ†ç±»æ•°æ®é‡‡é›†..."
python industry_collector.py

# éªŒè¯æ•°æ®
echo "éªŒè¯é‡‡é›†æ•°æ®..."
python test_industry.py

echo "ä»»åŠ¡å®Œæˆï¼"
```

## ðŸ”§ æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. ä¸‡å¾—Windè¿žæŽ¥é—®é¢˜
```bash
# é”™è¯¯: Wind connection failed
# è§£å†³æ–¹æ¡ˆ1: æ£€æŸ¥Windç»ˆç«¯æ˜¯å¦å·²å¯åŠ¨
# è§£å†³æ–¹æ¡ˆ2: é‡æ–°ç™»å½•Windç»ˆç«¯
# è§£å†³æ–¹æ¡ˆ3: ä½¿ç”¨å…è´¹æ•°æ®æºæ›¿ä»£

# æ£€æŸ¥WindæœåŠ¡çŠ¶æ€
python -c "
from WindPy import w
w.start()
print('Windè¿žæŽ¥çŠ¶æ€:', w.isconnected())
if not w.isconnected():
    print('è¯·æ£€æŸ¥Windç»ˆç«¯æ˜¯å¦æ­£å¸¸è¿è¡Œ')
"
```

#### 2. Tushare tokené…ç½®
```bash
# é”™è¯¯: No token set
# è§£å†³: åœ¨config.pyä¸­è®¾ç½®æ­£ç¡®çš„tushare token
python -c "
import tushare as ts
ts.set_token('your_token_here')
pro = ts.pro_api()
print('Tushareè¿žæŽ¥æµ‹è¯•æˆåŠŸ')
"
```

#### 3. æ•°æ®åº“è¿žæŽ¥å¤±è´¥
```bash
# é”™è¯¯: Access denied for user
# è§£å†³: æ£€æŸ¥æ•°æ®åº“é…ç½®å’Œæƒé™
mysql -u root -p -e "SHOW DATABASES;"
```

#### 4. ç½‘ç»œè¿žæŽ¥é—®é¢˜
```bash
# é”™è¯¯: Network timeout
# è§£å†³: ä½¿ç”¨å›½å†…é•œåƒæˆ–è°ƒæ•´è¶…æ—¶è®¾ç½®
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple tushare
```

## ðŸ“Š éªŒè¯æˆåŠŸæ ‡å‡†

### è¡Œä¸šæ•°æ®é‡‡é›†æˆåŠŸçš„æ ‡å¿—
1. **æ—¥å¿—æ˜¾ç¤ºæ— é”™è¯¯**: æŸ¥çœ‹industry_collector.logæ–‡ä»¶
2. **æ•°æ®åº“æœ‰æ•°æ®**: è¿è¡Œ `SELECT COUNT(*) FROM wind_industry_classification`
3. **è¡Œä¸šå±‚çº§å®Œæ•´**: ä¸€çº§ã€äºŒçº§ã€ä¸‰çº§è¡Œä¸šæ•°æ®å®Œæ•´
4. **æ˜ å°„å…³ç³»æ­£ç¡®**: ä¸åŒåˆ†ç±»æ ‡å‡†çš„æ˜ å°„å…³ç³»å»ºç«‹æˆåŠŸ

### æ£€æŸ¥å‘½ä»¤
```sql
-- è¿žæŽ¥MySQLæ•°æ®åº“
mysql -u root -p

-- ä½¿ç”¨æ•°æ®åº“
USE prevailing_trend;

-- æ£€æŸ¥è¡Œä¸šåˆ†ç±»æ€»æ•°
SELECT 
    industry_level as 'è¡Œä¸šå±‚çº§',
    COUNT(*) as 'æ•°é‡'
FROM wind_industry_classification 
GROUP BY industry_level;

-- æ£€æŸ¥ç”³ä¸‡è¡Œä¸šæ•°æ®
SELECT COUNT(*) as 'ç”³ä¸‡è¡Œä¸šæ•°é‡' FROM shenwan_industry_classification;

-- æ£€æŸ¥è¡Œä¸šæ˜ å°„å…³ç³»
SELECT COUNT(*) as 'æ˜ å°„å…³ç³»æ•°é‡' FROM industry_mapping;

-- æ£€æŸ¥ä»Šæ—¥æ›´æ–°æ•°æ®
SELECT 
    source as 'æ•°æ®æº',
    COUNT(*) as 'æ›´æ–°æ•°é‡'
FROM wind_industry_classification 
WHERE DATE(updated_at) = CURDATE()
GROUP BY source;
```

## ðŸŽ¯ æ€§èƒ½æœŸæœ›

### æ­£å¸¸è¿è¡ŒæŒ‡æ ‡
- **æ•°æ®é‡‡é›†æ—¶é—´**: 5-10åˆ†é’Ÿï¼ˆå–å†³äºŽæ•°æ®æºå’Œç½‘ç»œï¼‰
- **è¡Œä¸šæ•°é‡**: ä¸‡å¾—åˆ†ç±»~500ä¸ªï¼Œç”³ä¸‡åˆ†ç±»~230ä¸ª
- **æˆåŠŸçŽ‡**: >98%
- **å†…å­˜ä½¿ç”¨**: <200MB
- **ç£ç›˜ç©ºé—´**: <50MB

### ä¼˜åŒ–å»ºè®®
- **æ‰¹é‡å¤§å°**: å»ºè®®100-500æ¡/æ‰¹æ¬¡
- **å¹¶å‘æ•°**: å»ºè®®2-3ä¸ªçº¿ç¨‹
- **è¯·æ±‚é—´éš”**: å»ºè®®1-2ç§’/è¯·æ±‚
- **ç¼“å­˜ç­–ç•¥**: è¡Œä¸šæ•°æ®å¯ç¼“å­˜1å¤©

## ðŸ“… ç»´æŠ¤è®¡åˆ’

### å®šæœŸç»´æŠ¤
- **æ¯å­£åº¦**: æ£€æŸ¥ä¸‡å¾—è¡Œä¸šåˆ†ç±»è°ƒæ•´ï¼Œæ›´æ–°åˆ†ç±»æ ‡å‡†
- **æ¯æœˆ**: éªŒè¯è¡Œä¸šæ˜ å°„å…³ç³»ï¼Œå¤„ç†æ–°å¢žè¡Œä¸š
- **æ¯å‘¨**: æ£€æŸ¥æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§
- **æ¯æ—¥**: ç›‘æŽ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€å’Œæ—¥å¿—

### å‡çº§è·¯å¾„
1. **å…è´¹æ–¹æ¡ˆ**: Tushare + AKShare
2. **æ ‡å‡†æ–¹æ¡ˆ**: æ·»åŠ ä¸‡å¾—WindåŸºç¡€ç‰ˆ
3. **ä¸“ä¸šæ–¹æ¡ˆ**: ä¸‡å¾—Windä¸“ä¸šç‰ˆ + å®žæ—¶æ›´æ–°

## ðŸ†˜ æŠ€æœ¯æ”¯æŒ

### èŽ·å–å¸®åŠ©
1. **æŸ¥çœ‹æ—¥å¿—**: industry_collector.log
2. **æ£€æŸ¥é…ç½®**: config.pyä¸­çš„æ•°æ®æºè®¾ç½®
3. **ç½‘ç»œæµ‹è¯•**: pingæ•°æ®æºAPIåœ°å€
4. **ä¸‡å¾—æµ‹è¯•**: åœ¨Windç»ˆç«¯ä¸­æ‰‹åŠ¨æŸ¥è¯¢è¡Œä¸šæ•°æ®

### è”ç³»æ–¹å¼
- æŸ¥çœ‹è¯¦ç»†æ“ä½œæ‰‹å†Œ: `æ“ä½œæ‰‹å†Œ.md`
- å‚è€ƒæ•°æ®æºæ–¹æ¡ˆ: `æ•°æ®æºæŽ¥å…¥æ–¹æ¡ˆ.md`
- é…ç½®å‚æ•°è¯´æ˜Ž: `config.py`

---

**ðŸŽ‰ å‡†å¤‡å°±ç»ªï¼çŽ°åœ¨å¯ä»¥å¼€å§‹æ”¶é›†è¡Œä¸šåˆ†ç±»æ•°æ®äº†ï¼**

