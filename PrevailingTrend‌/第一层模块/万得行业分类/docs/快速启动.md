# 万得行业分类模块 - 快速启动指南

## 🚀 5分钟快速启动

### 前置条件
- Python 3.8+ 已安装
- MySQL 数据库已运行
- 万得Wind终端已安装（推荐）或准备使用免费数据源
- 网络连接正常

### 步骤1：环境准备 (2分钟)
```bash
# 1. 进入模块目录
cd "第一层模块/万得行业分类"

# 2. 创建虚拟环境
python -m venv venv

# 3. 激活虚拟环境
# Windows:
venv\Scripts\activate
# Linux/Mac:
# source venv/bin/activate

# 4. 安装依赖
pip install WindPy tushare akshare pandas requests mysql-connector-python schedule
```

### 步骤2：数据库初始化 (1分钟)
```bash
# 1. 进入数据库配置目录
cd "../../数据库配置"

# 2. 运行数据库初始化
python init_tables.py

# 3. 验证表创建
python -c "
import sys
sys.path.append('.')
from database_config import get_database_manager
db = get_database_manager()
db.connect()
result = db.execute_query('SHOW TABLES LIKE \"%industry%\"')
print('行业相关表:', result)
db.disconnect()
"
```

### 步骤3：测试数据源连接 (2分钟)
```bash
# 1. 回到模块目录
cd "../第一层模块/万得行业分类"

# 2. 测试万得连接（如果有Wind终端）
python -c "
try:
    from WindPy import w
    w.start()
    if w.isconnected():
        print('✅ 万得Wind连接成功')
    else:
        print('❌ 万得Wind连接失败')
except ImportError:
    print('⚠️ 万得Wind未安装，将使用免费数据源')
"

# 3. 测试免费数据源
python -c "
import tushare as ts
import akshare as ak
print('✅ Tushare版本:', ts.__version__)
print('✅ AKShare版本:', ak.__version__)
# 测试获取行业数据
try:
    df = ak.stock_board_industry_summary_ths()
    print(f'✅ 成功获取{len(df)}个行业板块数据')
except Exception as e:
    print(f'❌ 数据获取失败: {e}')
"
```

## 📁 必需的文件

### 核心文件清单
- `config.py` (配置文件)
- `requirements.txt` (依赖包列表)
- `industry_collector.py` (行业数据采集器)
- `industry_mapper.py` (行业分类映射器)
- `scheduler.py` (定时任务)
- `test_industry.py` (数据验证脚本)

### 快速创建配置文件
```python
# config.py
"""
万得行业分类模块配置
"""
import os

# 数据库配置
DATABASE_CONFIG = {
    'host': 'localhost',
    'port': 3306,
    'user': 'root',
    'password': 'your_password',
    'database': 'prevailing_trend',
    'charset': 'utf8mb4'
}

# 万得Wind配置
WIND_CONFIG = {
    'timeout': 30,
    'retry_count': 3,
    'retry_interval': 5
}

# Tushare配置
TUSHARE_TOKEN = "your_tushare_token"  # 在 https://tushare.pro 注册获取

# 数据采集配置
COLLECTION_CONFIG = {
    'update_frequency': 'quarterly',  # 季度更新
    'batch_size': 1000,
    'concurrent_requests': 3,
    'request_interval': 1  # 秒
}

# 行业分类标准优先级
INDUSTRY_SOURCE_PRIORITY = [
    'wind',      # 万得分类（优先）
    'shenwan',   # 申万分类
    'csrc',      # 证监会分类
    'tushare'    # Tushare分类（备用）
]

# 日志配置
LOG_CONFIG = {
    'level': 'INFO',
    'format': '%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    'file_path': 'industry_collector.log'
}
```

## 🏃‍♂️ 一键运行脚本

### Windows批处理脚本 (run_industry.bat)
```batch
@echo off
echo 启动万得行业分类数据采集系统...

REM 激活虚拟环境
call venv\Scripts\activate

REM 检查依赖
python -c "import WindPy, tushare, akshare, pandas, mysql.connector; print('依赖包检查通过')" || (
    echo 正在安装依赖...
    pip install WindPy tushare akshare pandas mysql-connector-python schedule
)

REM 运行行业数据采集
echo 开始行业分类数据采集...
python industry_collector.py

REM 验证数据
echo 验证采集数据...
python test_industry.py

echo 任务完成！
pause
```

### Linux/Mac脚本 (run_industry.sh)
```bash
#!/bin/bash
echo "启动万得行业分类数据采集系统..."

# 激活虚拟环境
source venv/bin/activate

# 检查依赖
python -c "import tushare, akshare, pandas, mysql.connector; print('依赖包检查通过')" || {
    echo "正在安装依赖..."
    pip install tushare akshare pandas mysql-connector-python schedule
}

# 运行行业数据采集
echo "开始行业分类数据采集..."
python industry_collector.py

# 验证数据
echo "验证采集数据..."
python test_industry.py

echo "任务完成！"
```

## 🔧 故障排除

### 常见问题及解决方案

#### 1. 万得Wind连接问题
```bash
# 错误: Wind connection failed
# 解决方案1: 检查Wind终端是否已启动
# 解决方案2: 重新登录Wind终端
# 解决方案3: 使用免费数据源替代

# 检查Wind服务状态
python -c "
from WindPy import w
w.start()
print('Wind连接状态:', w.isconnected())
if not w.isconnected():
    print('请检查Wind终端是否正常运行')
"
```

#### 2. Tushare token配置
```bash
# 错误: No token set
# 解决: 在config.py中设置正确的tushare token
python -c "
import tushare as ts
ts.set_token('your_token_here')
pro = ts.pro_api()
print('Tushare连接测试成功')
"
```

#### 3. 数据库连接失败
```bash
# 错误: Access denied for user
# 解决: 检查数据库配置和权限
mysql -u root -p -e "SHOW DATABASES;"
```

#### 4. 网络连接问题
```bash
# 错误: Network timeout
# 解决: 使用国内镜像或调整超时设置
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple tushare
```

## 📊 验证成功标准

### 行业数据采集成功的标志
1. **日志显示无错误**: 查看industry_collector.log文件
2. **数据库有数据**: 运行 `SELECT COUNT(*) FROM wind_industry_classification`
3. **行业层级完整**: 一级、二级、三级行业数据完整
4. **映射关系正确**: 不同分类标准的映射关系建立成功

### 检查命令
```sql
-- 连接MySQL数据库
mysql -u root -p

-- 使用数据库
USE prevailing_trend;

-- 检查行业分类总数
SELECT 
    industry_level as '行业层级',
    COUNT(*) as '数量'
FROM wind_industry_classification 
GROUP BY industry_level;

-- 检查申万行业数据
SELECT COUNT(*) as '申万行业数量' FROM shenwan_industry_classification;

-- 检查行业映射关系
SELECT COUNT(*) as '映射关系数量' FROM industry_mapping;

-- 检查今日更新数据
SELECT 
    source as '数据源',
    COUNT(*) as '更新数量'
FROM wind_industry_classification 
WHERE DATE(updated_at) = CURDATE()
GROUP BY source;
```

## 🎯 性能期望

### 正常运行指标
- **数据采集时间**: 5-10分钟（取决于数据源和网络）
- **行业数量**: 万得分类~500个，申万分类~230个
- **成功率**: >98%
- **内存使用**: <200MB
- **磁盘空间**: <50MB

### 优化建议
- **批量大小**: 建议100-500条/批次
- **并发数**: 建议2-3个线程
- **请求间隔**: 建议1-2秒/请求
- **缓存策略**: 行业数据可缓存1天

## 📅 维护计划

### 定期维护
- **每季度**: 检查万得行业分类调整，更新分类标准
- **每月**: 验证行业映射关系，处理新增行业
- **每周**: 检查数据完整性和一致性
- **每日**: 监控系统运行状态和日志

### 升级路径
1. **免费方案**: Tushare + AKShare
2. **标准方案**: 添加万得Wind基础版
3. **专业方案**: 万得Wind专业版 + 实时更新

## 🆘 技术支持

### 获取帮助
1. **查看日志**: industry_collector.log
2. **检查配置**: config.py中的数据源设置
3. **网络测试**: ping数据源API地址
4. **万得测试**: 在Wind终端中手动查询行业数据

### 联系方式
- 查看详细操作手册: `操作手册.md`
- 参考数据源方案: `数据源接入方案.md`
- 配置参数说明: `config.py`

---

**🎉 准备就绪！现在可以开始收集行业分类数据了！**

