# 公司名字列表 - 数据源接入方案

## 推荐数据源组合方案

### 方案一：免费数据源组合（适合初期开发）
```
主数据源：Tushare + AKShare
验证数据源：东方财富网
备用数据源：新浪财经
```

### 方案二：付费+免费组合（推荐生产环境）
```
主数据源：万得Wind API
补充数据源：Tushare
验证数据源：交易所官网
实时数据源：东方财富网
```

### 方案三：纯免费方案（成本敏感）
```
主数据源：AKShare
补充数据源：Tushare
验证数据源：东方财富网 + 新浪财经
```

## 数据源详细对比

| 数据源 | 成本 | 数据质量 | 更新频率 | API稳定性 | 推荐指数 |
|--------|------|----------|----------|-----------|----------|
| 万得Wind | 付费(高) | ⭐⭐⭐⭐⭐ | 实时 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| Tushare | 免费/付费 | ⭐⭐⭐⭐ | 日级 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| AKShare | 免费 | ⭐⭐⭐ | 日级 | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| 东方财富 | 免费 | ⭐⭐⭐⭐ | 实时 | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| 新浪财经 | 免费 | ⭐⭐⭐ | 实时 | ⭐⭐ | ⭐⭐⭐ |

## 具体接入代码示例

### 1. Tushare接入（推荐主要数据源）

```python
import tushare as ts

# 设置token（需要注册获取）
ts.set_token('your_tushare_token')
pro = ts.pro_api()

# 获取股票基本信息
def get_stock_basic_info():
    """获取股票基本信息"""
    try:
        # 获取股票列表
        df = pro.stock_basic(exchange='', 
                           list_status='L',  # L上市 D退市 P暂停上市
                           fields='ts_code,symbol,name,area,industry,market,list_date')
        return df
    except Exception as e:
        print(f"获取股票基本信息失败: {e}")
        return None

# 获取公司基本信息
def get_company_info():
    """获取公司基本信息"""
    try:
        df = pro.stock_company(exchange='SSE', 
                             fields='ts_code,chairman,manager,secretary,reg_capital,setup_date,province')
        return df
    except Exception as e:
        print(f"获取公司信息失败: {e}")
        return None
```

### 2. AKShare接入（补充数据源）

```python
import akshare as ak

def get_stock_info_akshare():
    """通过AKShare获取股票信息"""
    try:
        # 获取沪深A股实时行情数据
        stock_zh_a_spot_em_df = ak.stock_zh_a_spot_em()
        return stock_zh_a_spot_em_df[['代码', '名称', '总市值', '流通市值']]
    except Exception as e:
        print(f"AKShare获取数据失败: {e}")
        return None

def get_stock_industry_akshare():
    """获取股票行业分类"""
    try:
        # 获取股票行业分类
        stock_board_industry_summary_df = ak.stock_board_industry_summary_ths()
        return stock_board_industry_summary_df
    except Exception as e:
        print(f"获取行业分类失败: {e}")
        return None
```

### 3. 东方财富网接入（实时验证）

```python
import requests
import json

def get_eastmoney_stock_list():
    """从东方财富获取股票列表"""
    url = "http://80.push2.eastmoney.com/api/qt/clist/get"
    params = {
        'pn': 1,  # 页码
        'pz': 5000,  # 每页数量
        'po': 1,  # 排序方式
        'np': 1,  # 是否返回下一页
        'ut': 'bd1d9ddb04089700cf9c27f6f7426281',
        'fltt': 2,
        'invt': 2,
        'fid': 'f3',
        'fs': 'm:0+t:6,m:0+t:80,m:1+t:2,m:1+t:23',  # 沪深A股
        'fields': 'f1,f2,f3,f4,f5,f6,f7,f8,f9,f10,f12,f13,f14,f15,f16,f17,f18,f20,f21,f23,f24,f25,f22,f11,f62,f128,f136,f115,f152'
    }
    
    try:
        response = requests.get(url, params=params)
        data = response.json()
        if data['rc'] == 0:
            return data['data']['diff']
        return None
    except Exception as e:
        print(f"东方财富数据获取失败: {e}")
        return None
```

### 4. 万得Wind接入（生产环境推荐）

```python
# 需要安装Wind Python API
# pip install WindPy

from WindPy import w

def init_wind():
    """初始化Wind连接"""
    w.start()
    return w.isconnected()

def get_wind_stock_list():
    """通过Wind获取股票列表"""
    if not init_wind():
        print("Wind连接失败")
        return None
    
    try:
        # 获取A股股票列表
        data = w.wset("sectorconstituent",
                     "date=20231201;sectorid=a001010100000000")
        
        if data.ErrorCode == 0:
            return {
                'codes': data.Codes,
                'data': data.Data,
                'fields': data.Fields
            }
        else:
            print(f"Wind数据获取失败: {data.ErrorCode}")
            return None
    except Exception as e:
        print(f"Wind API调用失败: {e}")
        return None

def get_wind_company_info(stock_codes):
    """获取公司基本信息"""
    try:
        data = w.wss(stock_codes, 
                    "sec_name,listdate,ipo_date,mkt,exch_city,comp_name")
        
        if data.ErrorCode == 0:
            return {
                'codes': data.Codes,
                'data': data.Data,
                'fields': data.Fields
            }
        return None
    except Exception as e:
        print(f"获取公司信息失败: {e}")
        return None
```

## 数据源使用建议

### 初期开发阶段
1. **使用Tushare**: 注册免费账号，获取基础数据
2. **配合AKShare**: 补充Tushare缺失的数据
3. **验证数据**: 使用东方财富网接口验证数据准确性

### 生产环境
1. **主要数据源**: 万得Wind API（付费但数据最权威）
2. **备用数据源**: Tushare Pro版本
3. **实时验证**: 东方财富网 + 新浪财经

### 成本控制方案
1. **纯免费方案**: AKShare + 东方财富 + 新浪财经
2. **低成本方案**: Tushare基础版 + AKShare + 免费API验证
3. **高质量方案**: Wind + Tushare + 免费API补充

## 数据获取频率建议

### 全量数据更新
- **频率**: 每周末一次
- **内容**: 全市场股票列表、公司基本信息
- **数据源**: Wind API 或 Tushare

### 增量数据更新
- **频率**: 每日一次（交易日）
- **内容**: 新上市股票、状态变更
- **数据源**: 实时API（东方财富/新浪）

### 实时状态检查
- **频率**: 每小时一次（交易时间）
- **内容**: 交易状态、停牌信息
- **数据源**: 免费实时API

## 数据质量保证策略

### 1. 多源验证
```python
def verify_company_data(company_info):
    """多数据源验证公司信息"""
    # 从不同数据源获取同一公司信息
    tushare_data = get_tushare_company_info(company_info['code'])
    eastmoney_data = get_eastmoney_company_info(company_info['code'])
    
    # 交叉验证关键字段
    if tushare_data['name'] != eastmoney_data['name']:
        # 记录不一致的数据，需要人工确认
        log_data_inconsistency(company_info['code'], 'name', 
                             tushare_data['name'], eastmoney_data['name'])
    
    return True
```

### 2. 数据清洗规则
```python
def clean_company_name(name):
    """清洗公司名称"""
    # 移除特殊字符
    name = re.sub(r'[^\u4e00-\u9fa5\w\s]', '', name)
    # 统一格式
    name = name.replace('（', '(').replace('）', ')')
    # 去除多余空格
    name = ' '.join(name.split())
    return name

def validate_stock_code(code):
    """验证股票代码格式"""
    pattern = r'^(000|001|002|003|300|600|601|603|688|689)\d{3}$'
    return bool(re.match(pattern, code))
```

### 3. 异常处理
```python
def handle_api_error(api_name, error, retry_count=3):
    """API错误处理"""
    if retry_count > 0:
        time.sleep(5)  # 等待5秒后重试
        return call_api_with_retry(api_name, retry_count - 1)
    else:
        # 切换到备用数据源
        return switch_to_backup_source(api_name)
```

## 实施建议

### 第一步：选择主要数据源
根据预算和需求选择合适的数据源组合

### 第二步：申请API权限
- Tushare: 注册账号，获取token
- Wind: 购买API权限（如预算允许）
- 免费API: 了解调用限制

### 第三步：搭建基础框架
先实现一个数据源的完整流程，再逐步添加其他数据源

### 第四步：数据质量控制
建立数据验证、清洗、监控机制

### 第五步：生产部署
考虑容错、监控、报警等生产环境需求
