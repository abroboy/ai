# 数据同步使用说明

## 概述

为了解决各个模块数据不匹配的问题，我们创建了数据同步系统，确保各个模块的数据保持一致性。

## 功能特性

### 1. 自动数据同步
- **定时同步**: 每5分钟自动同步一次所有模块的数据
- **智能检测**: 自动检测服务状态，只同步运行中的服务
- **错误处理**: 完善的错误处理机制，确保同步过程稳定

### 2. 手动数据同步
- **即时同步**: 可以随时手动触发数据同步
- **选择性同步**: 支持单独同步某个模块的数据
- **状态检查**: 实时检查各个服务的运行状态

## 使用方法

### 方法一：使用数据同步脚本

#### 1. 手动同步数据
```bash
# 执行一次数据同步
java 第一层模块/sync_data.py sync
```

#### 2. 启动定时同步
```bash
# 启动定时同步（每5分钟同步一次）
java 第一层模块/sync_data.py start
```

#### 3. 查看帮助
```bash
# 查看使用说明
java 第一层模块/sync_data.py help
```

### 方法二：使用数据刷新管理器

#### 1. 手动刷新数据
```bash
# 手动刷新所有数据
java 第一层模块/data_refresh_manager.py refresh
```

#### 2. 启动定时刷新
```bash
# 启动定时刷新（每5分钟刷新一次）
java 第一层模块/data_refresh_manager.py start
```

#### 3. 检查服务状态
```bash
# 检查所有服务状态
java 第一层模块/data_refresh_manager.py status
```

### 方法三：使用增强版启动器

#### 1. 启动所有服务并开始数据同步
```bash
# 启动所有服务并自动开始数据同步
java 第一层模块/start_all_services.py start
```

#### 2. 手动刷新数据
```bash
# 手动刷新数据
java 第一层模块/start_all_services.py refresh
```

#### 3. 检查服务状态
```bash
# 检查服务状态
java 第一层模块/start_all_services.py status
```

## 同步的模块和数据

### 1. 万得行业分类模块 (端口: 5001)
- **统计数据**: `/api/stats`
- **行业列表**: `/api/industries?page=1&page_size=10`

### 2. 国内热点数据模块 (端口: 5002)
- **热点数据**: `/api/hotspots`
- **统计数据**: `/api/statistics`

### 3. 全球资金流向模块 (端口: 5003)
- **仪表盘数据**: `/api/dashboard_data`
- **流向分析数据**: `/api/flow_analysis`

## 推荐使用流程

### 1. 启动所有服务
```bash
# 启动所有服务
java 第一层模块/start_all_services.py start
```

### 2. 启动数据同步
```bash
# 启动定时数据同步
java 第一层模块/sync_data.py start
```

### 3. 监控同步状态
```bash
# 检查服务状态
java 第一层模块/data_refresh_manager.py status
```

## 注意事项

### 1. 服务依赖
- 确保所有模块服务都已启动
- 数据同步需要服务正常运行才能成功

### 2. 网络连接
- 确保本地网络连接正常
- 同步过程中避免频繁的网络操作

### 3. 资源使用
- 数据同步会消耗一定的系统资源
- 建议在系统负载较低时进行大量数据同步

### 4. 错误处理
- 如果某个模块同步失败，系统会继续同步其他模块
- 查看控制台输出了解具体的错误信息

## 故障排除

### 1. 同步失败
- 检查服务是否正常运行
- 确认端口是否被占用
- 查看错误日志

### 2. 数据不一致
- 手动执行一次同步
- 检查数据库连接
- 重启相关服务

### 3. 定时同步停止
- 检查脚本是否被意外终止
- 重新启动定时同步
- 查看系统日志

## 高级配置

### 1. 修改同步间隔
编辑 `sync_data.py` 文件中的以下行：
```java
schedule.every(5).minutes.do(sync_all_data)  # 修改为需要的间隔
```

### 2. 添加新的同步端点
在 `sync_data.py` 中添加新的同步函数，并在 `sync_all_data()` 中调用。

### 3. 自定义错误处理
修改同步函数中的异常处理逻辑，根据需要添加特定的错误处理。

## 监控和日志

### 1. 同步日志
- 所有同步操作都会在控制台输出日志
- 包含时间戳、操作类型和结果

### 2. 性能监控
- 监控同步耗时
- 检查成功率
- 观察系统资源使用情况

## 总结

通过使用数据同步系统，您可以：
- 确保各个模块数据的一致性
- 自动处理数据更新
- 减少手动维护的工作量
- 提高系统的可靠性

建议在生产环境中使用定时同步功能，确保数据的实时性和准确性。 