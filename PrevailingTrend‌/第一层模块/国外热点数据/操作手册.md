# 国外热点数据模块操作手册

## 快速开始

### 1. 环境准备

确保您的系统已安装：
- Python 3.8+
- MySQL 5.7+
- 网络连接

### 2. 安装依赖

```bash
cd 第一层模块/国外热点数据
pip install -r requirements.txt
```

### 3. 配置数据库

复制环境变量文件并配置：

```bash
cp env.example .env
```

编辑 `.env` 文件，设置数据库连接信息：

```env
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=pt
```

### 4. 启动服务

```bash
python start.py
```

服务将在 http://localhost:5004 启动。

## 功能操作

### Web界面操作

1. **访问首页**
   - 打开浏览器访问 http://localhost:5004
   - 查看服务状态和基本统计信息

2. **查看仪表盘**
   - 点击"查看仪表盘"或访问 http://localhost:5004/dashboard
   - 查看详细的数据统计和热点列表

3. **手动收集数据**
   - 在首页点击"收集数据"按钮
   - 系统将自动从配置的数据源收集最新热点信息

### API接口使用

1. **健康检查**
   ```bash
   curl http://localhost:5004/api/health
   ```

2. **获取热点数据**
   ```bash
   curl http://localhost:5004/api/hotspots?limit=50
   ```

3. **获取统计数据**
   ```bash
   curl http://localhost:5004/api/statistics
   ```

4. **手动触发数据收集**
   ```bash
   curl -X POST http://localhost:5004/api/collect
   ```

## 数据源管理

### 查看当前数据源

在 `config.py` 文件中查看 `DATA_SOURCES` 配置：

```python
DATA_SOURCES = {
    'news_sources': [
        {'name': 'Reuters', 'url': 'https://www.reuters.com/', 'enabled': True},
        {'name': 'Bloomberg', 'url': 'https://www.bloomberg.com/', 'enabled': True},
        # ... 更多数据源
    ]
}
```

### 添加新数据源

1. 在 `config.py` 的 `DATA_SOURCES` 中添加新数据源配置
2. 在 `international_hotspot_collector.py` 中添加对应的解析方法
3. 重启服务使配置生效

### 启用/禁用数据源

修改数据源配置中的 `enabled` 字段：
- `'enabled': True` - 启用数据源
- `'enabled': False` - 禁用数据源

## 数据监控

### 查看日志

```bash
# 查看实时日志
tail -f logs/international_hotspot.log

# 查看错误日志
grep "ERROR" logs/international_hotspot.log
```

### 数据库监控

1. **查看数据统计**
   ```python
   from core.international_hotspot_manager import InternationalHotspotManager
   
   manager = InternationalHotspotManager()
   stats = manager.get_statistics()
   print(stats)
   ```

2. **检查数据质量**
   ```python
   hotspots = manager.get_hotspots(limit=100)
   for hotspot in hotspots:
       print(f"{hotspot['title']} - {hotspot['source']} - {hotspot['created_at']}")
   ```

## 故障排除

### 常见问题

1. **服务无法启动**
   - 检查端口5004是否被占用
   - 确认数据库连接配置正确
   - 查看错误日志获取详细信息

2. **数据收集失败**
   - 检查网络连接
   - 确认数据源URL可访问
   - 查看收集器日志

3. **数据库连接失败**
   - 确认MySQL服务正在运行
   - 检查数据库用户权限
   - 验证连接参数

### 性能优化

1. **调整并发数**
   修改 `config.py` 中的 `MAX_WORKERS` 参数

2. **设置超时时间**
   调整 `REQUEST_TIMEOUT` 参数

3. **数据清理**
   定期清理过期数据以保持数据库性能

## 维护任务

### 日常维护

1. **检查服务状态**
   ```bash
   curl http://localhost:5004/api/health
   ```

2. **查看数据统计**
   ```bash
   curl http://localhost:5004/api/statistics
   ```

3. **手动收集数据**
   ```bash
   curl -X POST http://localhost:5004/api/collect
   ```

### 定期维护

1. **日志清理**
   - 定期清理旧的日志文件
   - 监控日志文件大小

2. **数据库维护**
   - 定期备份数据
   - 清理过期数据
   - 优化数据库性能

3. **系统更新**
   - 更新依赖包
   - 检查数据源配置
   - 更新分析规则

## 扩展开发

### 添加新的分析功能

1. 在 `international_hotspot_analyzer.py` 中添加新的分析方法
2. 更新数据模型以支持新字段
3. 修改数据库表结构

### 自定义数据源

1. 在配置中添加新数据源
2. 实现对应的解析逻辑
3. 测试数据收集功能

### 集成其他系统

通过API接口可以轻松集成到其他系统中：

```python
import requests

# 获取热点数据
response = requests.get('http://localhost:5004/api/hotspots')
hotspots = response.json()['data']

# 获取统计数据
response = requests.get('http://localhost:5004/api/statistics')
stats = response.json()['data']
```

## 联系支持

如遇到问题或需要技术支持，请：
1. 查看日志文件获取错误信息
2. 检查配置文件是否正确
3. 联系开发团队获取帮助 