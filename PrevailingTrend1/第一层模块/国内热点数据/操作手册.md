# 国内热点数据模块操作手册

## 模块概述

国内热点数据模块负责收集、分析和处理国内市场的热点信息，包括新闻热点、政策热点、市场热点等。该模块为整个大势所趋风险框架提供国内市场的热点信息基础。

## 功能特性

- **多源数据采集**: 支持新闻网站、政策发布平台、市场数据源等
- **热点识别**: 自动识别和分类热点信息
- **情感分析**: 对热点信息进行情感倾向分析
- **热度评估**: 评估热点信息的热度级别
- **关联分析**: 分析热点与公司、行业的关联关系
- **实时更新**: 支持实时数据更新和监控
- **Web管理台**: 提供可视化的数据管理界面

## 系统架构

```
国内热点数据模块/
├── config.py              # 配置文件
├── app.py                 # Web应用
├── start.py               # 启动脚本
├── requirements.txt       # 依赖包
├── README.md             # 说明文档
├── 操作手册.md           # 操作手册
├── core/                 # 核心模块
│   ├── __init__.py
│   ├── data_collector.py # 数据采集器
│   └── data_processor.py # 数据处理器
├── models/               # 数据模型
│   ├── __init__.py
│   └── hotspot_model.py  # 热点数据模型
├── utils/                # 工具模块
│   ├── __init__.py
│   └── database.py       # 数据库工具
├── templates/            # Web模板
│   ├── index.html        # 主页面
│   └── dashboard.html    # 仪表盘
├── static/               # 静态资源
│   └── js/
│       └── dashboard.js  # 前端脚本
└── logs/                 # 日志目录
```

## 安装部署

### 1. 环境要求

- Python 3.8+
- MySQL 5.7+
- Redis (可选，用于缓存)

### 2. 安装依赖

```bash
cd 第一层模块/国内热点数据
pip install -r requirements.txt
```

### 3. 配置数据库

编辑 `config.py` 文件中的数据库配置：

```python
DATABASE = {
    'host': 'localhost',
    'port': 3306,
    'user': 'root',
    'password': 'your_password',
    'database': 'pt',
    'charset': 'utf8mb4'
}
```

### 4. 创建环境变量文件

创建 `.env` 文件：

```env
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=pt
WEB_PORT=5002
DEBUG=False
```

## 启动服务

### 1. 启动完整服务

```bash
python start.py
```

这将启动：
- Web管理台 (端口5002)
- 数据采集服务
- 数据库初始化

### 2. 仅启动Web服务

```bash
python app.py
```

### 3. 运行测试

```bash
python hotspot_test.py
```

## Web管理台使用

### 1. 访问管理台

打开浏览器访问：`http://localhost:5002`

### 2. 功能模块

#### 仪表盘
- 显示热点数据统计信息
- 热点类型分布图表
- 热度级别分布图表
- 最新热点列表

#### 热点列表
- 查看所有热点数据
- 支持多条件筛选
- 分页显示
- 热点详情查看

#### 统计分析
- 关键词统计
- 相关公司统计
- 数据趋势分析

#### 数据采集
- 手动触发数据采集
- 查看采集日志
- 采集状态监控

#### 系统设置
- 数据源配置
- 采集参数设置
- 系统配置管理

### 3. 操作说明

#### 查看热点详情
1. 在热点列表中点击热点标题
2. 或点击"查看"按钮
3. 在弹出的模态框中查看详细信息

#### 筛选热点数据
1. 在热点列表页面使用筛选器
2. 选择类型、级别、来源、状态等条件
3. 点击"筛选"按钮

#### 手动采集数据
1. 进入"数据采集"页面
2. 点击"开始采集"按钮
3. 查看采集日志了解进度

## API接口

### 1. 获取热点列表

```
GET /api/hotspots
```

参数：
- `page`: 页码 (默认1)
- `per_page`: 每页数量 (默认20)
- `hotspot_type`: 热点类型
- `hotspot_level`: 热度级别
- `status`: 状态
- `source`: 来源

### 2. 获取热点详情

```
GET /api/hotspots/{hotspot_id}
```

### 3. 获取统计信息

```
GET /api/statistics
```

### 4. 采集热点数据

```
POST /api/collect
```

### 5. 更新热点数据

```
PUT /api/hotspots/{hotspot_id}
```

### 6. 删除热点数据

```
DELETE /api/hotspots/{hotspot_id}
```

## 数据模型

### 热点数据表 (l1_domestic_hotspot_data)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGINT | 主键ID |
| hotspot_id | VARCHAR(100) | 热点ID |
| title | VARCHAR(500) | 热点标题 |
| content | TEXT | 热点内容 |
| hotspot_type | VARCHAR(20) | 热点类型 |
| hotspot_level | VARCHAR(20) | 热度级别 |
| status | VARCHAR(20) | 状态 |
| source | VARCHAR(100) | 数据来源 |
| url | VARCHAR(1000) | 原始链接 |
| publish_time | DATETIME | 发布时间 |
| keywords | JSON | 关键词列表 |
| related_companies | JSON | 相关公司列表 |
| related_industries | JSON | 相关行业列表 |
| sentiment_score | DECIMAL(3,2) | 情感得分 |
| heat_score | DECIMAL(5,2) | 热度得分 |
| update_date | DATETIME | 数据更新日期 |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

### 热点类型

- `news`: 新闻热点
- `policy`: 政策热点
- `industry`: 行业热点
- `company`: 公司热点
- `market`: 市场热点
- `economy`: 经济热点

### 热度级别

- `low`: 低热度
- `medium`: 中等热度
- `high`: 高热度
- `very_high`: 极高热度

### 状态

- `active`: 活跃
- `declining`: 热度下降
- `expired`: 已过期

## 配置说明

### 数据源配置

```python
DATA_SOURCES = {
    'news_sources': [
        {
            'name': '新浪财经',
            'url': 'https://finance.sina.com.cn/',
            'type': 'news',
            'enabled': True
        }
    ],
    'policy_sources': [
        {
            'name': '中国政府网',
            'url': 'http://www.gov.cn/',
            'type': 'policy',
            'enabled': True
        }
    ]
}
```

### 分析配置

```python
ANALYSIS = {
    'sentiment_analysis': {
        'enabled': True,
        'model': 'snownlp',
        'threshold': 0.3
    },
    'heat_calculation': {
        'enabled': True,
        'factors': ['read_count', 'comment_count', 'share_count', 'time_decay'],
        'weights': [0.3, 0.2, 0.2, 0.3]
    }
}
```

### 更新配置

```python
UPDATE = {
    'auto_update': True,
    'update_interval': 300,  # 5分钟
    'batch_size': 100,
    'max_concurrent': 5
}
```

## 监控维护

### 1. 日志监控

日志文件位置：`logs/hotspot.log`

主要日志类型：
- INFO: 正常运行信息
- WARNING: 警告信息
- ERROR: 错误信息

### 2. 数据库监控

检查数据表状态：
```sql
SELECT COUNT(*) FROM l1_domestic_hotspot_data;
SELECT hotspot_type, COUNT(*) FROM l1_domestic_hotspot_data GROUP BY hotspot_type;
```

### 3. 性能监控

- 数据采集频率
- 数据库连接状态
- Web服务响应时间

## 故障排除

### 1. 数据库连接失败

检查：
- 数据库服务是否启动
- 连接参数是否正确
- 网络连接是否正常

### 2. 数据采集失败

检查：
- 网络连接是否正常
- 目标网站是否可访问
- 采集配置是否正确

### 3. Web服务无法访问

检查：
- 端口是否被占用
- 防火墙设置
- 服务是否正常启动

### 4. 数据质量问题

检查：
- 数据源配置
- 分析算法参数
- 数据清洗规则

## 扩展开发

### 1. 添加新数据源

1. 在 `config.py` 中添加数据源配置
2. 在 `data_collector.py` 中实现采集逻辑
3. 测试采集功能

### 2. 优化分析算法

1. 修改 `data_processor.py` 中的分析逻辑
2. 调整配置参数
3. 验证分析结果

### 3. 扩展Web功能

1. 在 `app.py` 中添加新的API接口
2. 创建对应的前端页面
3. 更新路由配置

## 联系支持

如有问题或建议，请联系开发团队。 