# 万得行业分类模块 - 快速部署指南

## 快速开始

### 1. 环境准备
```bash
# 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Linux/Mac
# 或
venv\Scripts\activate     # Windows

# 安装依赖
pip install -r requirements.txt
```

### 2. 配置数据库
```bash
# 创建.env文件
echo "DB_HOST=localhost" > .env
echo "DB_PORT=3306" >> .env
echo "DB_NAME=prevailing_trend" >> .env
echo "DB_USER=root" >> .env
echo "DB_PASSWORD=your_password" >> .env
```

### 3. 初始化系统
```bash
# 初始化数据库
python main.py --action init

# 更新数据
python main.py --action update

# 验证部署
python main.py --action stats
```

### 4. 启动API服务
```bash
# 启动API服务
python api_server.py --service combined --port 5000
```

### 5. 测试API
```bash
# 测试健康检查
curl http://localhost:5000/health

# 获取行业列表
curl http://localhost:5000/industry/api/industries

# 搜索行业
curl "http://localhost:5000/industry/api/industries/search?keyword=电子"
```

## 生产环境部署

### 使用Docker
```bash
# 构建镜像
docker build -t industry-classification .

# 运行容器
docker run -d -p 5000:5000 --name industry-api industry-classification
```

### 使用Systemd
```bash
# 创建服务文件
sudo tee /etc/systemd/system/industry-classification.service << EOF
[Unit]
Description=Industry Classification API
After=network.target

[Service]
Type=simple
User=industry
WorkingDirectory=/opt/industry-classification
ExecStart=/opt/industry-classification/venv/bin/python api_server.py
Restart=always

[Install]
WantedBy=multi-user.target
EOF

# 启动服务
sudo systemctl enable industry-classification
sudo systemctl start industry-classification
```

## 监控和维护

### 日志查看
```bash
# 查看应用日志
tail -f logs/industry_classification_$(date +%Y%m%d).log

# 查看服务日志
sudo journalctl -u industry-classification -f
```

### 数据备份
```bash
# 备份数据库
mysqldump -u root -p prevailing_trend > backup_$(date +%Y%m%d).sql

# 恢复数据库
mysql -u root -p prevailing_trend < backup_20231201.sql
```

### 定时更新
```bash
# 添加到crontab
0 2 * * * cd /opt/industry-classification && python main.py --action update
```

## 故障排除

### 常见问题
1. **数据库连接失败**: 检查.env配置和数据库服务状态
2. **API服务无法启动**: 检查端口占用和日志文件
3. **数据更新失败**: 检查数据源配置和网络连接

### 性能优化
1. **数据库索引**: 为常用查询字段添加索引
2. **缓存**: 使用Redis缓存热点数据
3. **连接池**: 配置数据库连接池

## API接口说明

### 行业相关接口
- `GET /industry/api/industries` - 获取行业列表
- `GET /industry/api/industries/{code}` - 获取行业详情
- `GET /industry/api/industries/search?keyword=xxx` - 搜索行业
- `GET /industry/api/industries/statistics` - 获取统计信息

### 股票相关接口
- `GET /stock/api/stocks/industry/{code}` - 获取行业下的股票
- `GET /stock/api/stocks/{code}` - 获取股票行业信息
- `GET /stock/api/stocks/search?keyword=xxx` - 搜索股票
- `GET /stock/api/stocks/statistics` - 获取股票统计信息

## 成功指标
- 系统启动时间 < 30秒
- API响应时间 < 500ms
- 数据更新成功率 > 95%
- 系统可用性 > 99.5% 